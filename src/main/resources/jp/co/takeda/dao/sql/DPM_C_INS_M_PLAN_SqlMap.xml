<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="DPM_C_INS_M_PLAN_SqlMap" >
  <resultMap id="resultMap" class="jp.co.takeda.model.ManageInsMonthPlan" >
    <result column="SEQ_KEY" property="seqKey" jdbcType="BIGINT" />
    <result column="CAL_YEAR" property="calYear" jdbcType="CHAR" />
    <result column="CAL_TERM" property="calTerm" jdbcType="CHAR" />
    <result column="PROD_CODE" property="prodCode" jdbcType="CHAR" />
    <result column="INS_NO" property="insNo" jdbcType="VARCHAR" />
    <result column="PLANNED_TERM_VALUE" property="implMonthPlan.plannedTermValue" jdbcType="BIGINT" />
    <result column="PLANNED_1_VALUE_YB" property="implMonthPlan.planned1ValueYb" jdbcType="BIGINT" />
    <result column="PLANNED_2_VALUE_YB" property="implMonthPlan.planned2ValueYb" jdbcType="BIGINT" />
    <result column="PLANNED_3_VALUE_YB" property="implMonthPlan.planned3ValueYb" jdbcType="BIGINT" />
    <result column="PLANNED_4_VALUE_YB" property="implMonthPlan.planned4ValueYb" jdbcType="BIGINT" />
    <result column="PLANNED_5_VALUE_YB" property="implMonthPlan.planned5ValueYb" jdbcType="BIGINT" />
    <result column="PLANNED_6_VALUE_YB" property="implMonthPlan.planned6ValueYb" jdbcType="BIGINT" />
    <result column="EXPECTED_1_VALUE_YB" property="implMonthPlan.expected1ValueYb" jdbcType="BIGINT" />
    <result column="EXPECTED_2_VALUE_YB" property="implMonthPlan.expected2ValueYb" jdbcType="BIGINT" />
    <result column="EXPECTED_3_VALUE_YB" property="implMonthPlan.expected3ValueYb" jdbcType="BIGINT" />
    <result column="EXPECTED_4_VALUE_YB" property="implMonthPlan.expected4ValueYb" jdbcType="BIGINT" />
    <result column="EXPECTED_5_VALUE_YB" property="implMonthPlan.expected5ValueYb" jdbcType="BIGINT" />
    <result column="EXPECTED_6_VALUE_YB" property="implMonthPlan.expected6ValueYb" jdbcType="BIGINT" />
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    <result column="TOKI_1MON_Y_KIN" property="implMonthPlan.record1ValueY" jdbcType="BIGINT" />
    <result column="TOKI_1MON_B_KIN" property="implMonthPlan.record1ValueB" jdbcType="BIGINT" />
    <result column="TOKI_2MON_Y_KIN" property="implMonthPlan.record2ValueY" jdbcType="BIGINT" />
    <result column="TOKI_2MON_B_KIN" property="implMonthPlan.record2ValueB" jdbcType="BIGINT" />
    <result column="TOKI_3MON_Y_KIN" property="implMonthPlan.record3ValueY" jdbcType="BIGINT" />
    <result column="TOKI_3MON_B_KIN" property="implMonthPlan.record3ValueB" jdbcType="BIGINT" />
    <result column="TOKI_4MON_Y_KIN" property="implMonthPlan.record4ValueY" jdbcType="BIGINT" />
    <result column="TOKI_4MON_B_KIN" property="implMonthPlan.record4ValueB" jdbcType="BIGINT" />
    <result column="TOKI_5MON_Y_KIN" property="implMonthPlan.record5ValueY" jdbcType="BIGINT" />
    <result column="TOKI_5MON_B_KIN" property="implMonthPlan.record5ValueB" jdbcType="BIGINT" />
    <result column="TOKI_6MON_Y_KIN" property="implMonthPlan.record6ValueY" jdbcType="BIGINT" />
    <result column="TOKI_6MON_B_KIN" property="implMonthPlan.record6ValueB" jdbcType="BIGINT" />
    <result column="TOKI_TOTAL_Y_KIN" property="implMonthPlan.recordTotalValueY" jdbcType="BIGINT" />
    <result column="TOKI_TOTAL_B_KIN" property="implMonthPlan.recordTotalValueB" jdbcType="BIGINT" />
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    <result column="DEL_FLG" property="delFlg" jdbcType="CHAR" />
    <result column="IS_JGI_NO" property="isJgiNo" jdbcType="INTEGER" />
    <result column="IS_JGI_NAME" property="isJgiName" jdbcType="VARCHAR" />
    <result column="IS_DATE" property="isDate" jdbcType="TIMESTAMP" />
    <result column="IS_PG_ID" property="isPgId" jdbcType="VARCHAR" />
    <result column="UP_JGI_NO" property="upJgiNo" jdbcType="INTEGER" />
    <result column="UP_JGI_NAME" property="upJgiName" jdbcType="VARCHAR" />
    <result column="UP_DATE" property="upDate" jdbcType="TIMESTAMP" />
    <result column="UP_PG_ID" property="upPgId" jdbcType="VARCHAR" />
    <result column="INS_ABBR_NAME" property="insAbbrName" jdbcType="VARCHAR" />
    <result column="PROD_NAME" property="prodName" jdbcType="VARCHAR" />
    <result column="TRADE_TYPE" property="tradeType" jdbcType="VARCHAR" />
    <result column="REQ_FLG" property="reqFlg" jdbcType="INTEGER" />
    <result column="INS_DEL_FLG" property="insDelFlg" jdbcType="INTEGER" />
    <result column="INS_CLASS" property="insClass" jdbcType="VARCHAR" />
    <result column="OLD_INSR_FLG" property="oldInsrFlg" jdbcType="VARCHAR" />
    <result column="JGI_NO" property="jgiMst.jgiNo" jdbcType="INTEGER" />
    <result column="JGI_NAME" property="jgiMst.jgiName" jdbcType="VARCHAR" />
    <result column="SOS_CD2" property="jgiMst.sosCd2" jdbcType="VARCHAR" />
    <result column="SOS_CD3" property="jgiMst.sosCd3" jdbcType="VARCHAR" />
    <result column="ETC_SOS_FLG" property="sosMst.etcSosFlg" jdbcType="CHAR" nullValue="0"/>
    <result column="SUM_PLANNED_TERM_VALUE" property="sumPlannedTermValue" jdbcType="BIGINT" />
    <result column="SUM_PLANNED_1_VALUE_YB" property="sumPlanned1ValueYb" jdbcType="BIGINT" />
    <result column="SUM_PLANNED_2_VALUE_YB" property="sumPlanned2ValueYb" jdbcType="BIGINT" />
    <result column="SUM_PLANNED_3_VALUE_YB" property="sumPlanned3ValueYb" jdbcType="BIGINT" />
    <result column="SUM_PLANNED_4_VALUE_YB" property="sumPlanned4ValueYb" jdbcType="BIGINT" />
    <result column="SUM_PLANNED_5_VALUE_YB" property="sumPlanned5ValueYb" jdbcType="BIGINT" />
    <result column="SUM_PLANNED_6_VALUE_YB" property="sumPlanned6ValueYb" jdbcType="BIGINT" />
    <result column="SUM_EXPECTED_1_VALUE_YB" property="sumExpected1ValueYb" jdbcType="BIGINT" />
    <result column="SUM_EXPECTED_2_VALUE_YB" property="sumExpected2ValueYb" jdbcType="BIGINT" />
    <result column="SUM_EXPECTED_3_VALUE_YB" property="sumExpected3ValueYb" jdbcType="BIGINT" />
    <result column="SUM_EXPECTED_4_VALUE_YB" property="sumExpected4ValueYb" jdbcType="BIGINT" />
    <result column="SUM_EXPECTED_5_VALUE_YB" property="sumExpected5ValueYb" jdbcType="BIGINT" />
    <result column="SUM_EXPECTED_6_VALUE_YB" property="sumExpected6ValueYb" jdbcType="BIGINT" />
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    <result column="SUM_TOKI_1MON_Y_KIN" property="record1ValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_1MON_B_KIN" property="record1ValueB" jdbcType="BIGINT" />
    <result column="SUM_TOKI_2MON_Y_KIN" property="record2ValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_2MON_B_KIN" property="record2ValueB" jdbcType="BIGINT" />
    <result column="SUM_TOKI_3MON_Y_KIN" property="record3ValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_3MON_B_KIN" property="record3ValueB" jdbcType="BIGINT" />
    <result column="SUM_TOKI_4MON_Y_KIN" property="record4ValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_4MON_B_KIN" property="record4ValueB" jdbcType="BIGINT" />
    <result column="SUM_TOKI_5MON_Y_KIN" property="record5ValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_5MON_B_KIN" property="record5ValueB" jdbcType="BIGINT" />
    <result column="SUM_TOKI_6MON_Y_KIN" property="record6ValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_6MON_B_KIN" property="record6ValueB" jdbcType="BIGINT" />
    <result column="SUM_TOKI_TOTAL_Y_KIN" property="recordTotalValueY" jdbcType="BIGINT" />
    <result column="SUM_TOKI_TOTAL_B_KIN" property="recordTotalValueB" jdbcType="BIGINT" />
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    <result column="ADDR_CODE_PREF" property="addrCodePref" jdbcType="VARCHAR" />
    <result column="ADDR_CODE_CITY" property="addrCodeCity" jdbcType="VARCHAR" />
    <result column="SHIKUCHOSON_MEI_KJ" property="shikuchosonMeiKj" jdbcType="VARCHAR" />
    <result column="ACTIVITY_TYPE" property="activityType" jdbcType="CHAR" />
    <result column="TARGET_SUMMARY" property="targetSummary" jdbcType="VARCHAR" />
  </resultMap>

  <sql id="column">
     IMP.SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
          ,IMP.PROD_CODE
          ,IMP.INS_NO
          ,IMP.PLANNED_1_VALUE_YB
          ,IMP.PLANNED_2_VALUE_YB
          ,IMP.PLANNED_3_VALUE_YB
          ,IMP.PLANNED_4_VALUE_YB
          ,IMP.PLANNED_5_VALUE_YB
          ,IMP.PLANNED_6_VALUE_YB
          ,IMP.EXPECTED_1_VALUE_YB
          ,IMP.EXPECTED_2_VALUE_YB
          ,IMP.EXPECTED_3_VALUE_YB
          ,IMP.EXPECTED_4_VALUE_YB
          ,IMP.EXPECTED_5_VALUE_YB
          ,IMP.EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS SUM_TOKI_1MON_Y_KIN
          ,NULL AS SUM_TOKI_1MON_B_KIN
          ,NULL AS SUM_TOKI_2MON_Y_KIN
          ,NULL AS SUM_TOKI_2MON_B_KIN
          ,NULL AS SUM_TOKI_3MON_Y_KIN
          ,NULL AS SUM_TOKI_3MON_B_KIN
          ,NULL AS SUM_TOKI_4MON_Y_KIN
          ,NULL AS SUM_TOKI_4MON_B_KIN
          ,NULL AS SUM_TOKI_5MON_Y_KIN
          ,NULL AS SUM_TOKI_5MON_B_KIN
          ,NULL AS SUM_TOKI_6MON_Y_KIN
          ,NULL AS SUM_TOKI_6MON_B_KIN
          ,NULL AS SUM_TOKI_TOTAL_Y_KIN
          ,NULL AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,IMP.DEL_FLG
          ,IMP.IS_JGI_NO
          ,IMP.IS_JGI_NAME
          ,IMP.IS_DATE
          ,IMP.IS_PG_ID
          ,IMP.UP_JGI_NO
          ,IMP.UP_JGI_NAME
          ,IMP.UP_DATE
          ,IMP.UP_PG_ID
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS SUM_TOKI_1MON_Y_KIN
          ,NULL AS SUM_TOKI_1MON_B_KIN
          ,NULL AS SUM_TOKI_2MON_Y_KIN
          ,NULL AS SUM_TOKI_2MON_B_KIN
          ,NULL AS SUM_TOKI_3MON_Y_KIN
          ,NULL AS SUM_TOKI_3MON_B_KIN
          ,NULL AS SUM_TOKI_4MON_Y_KIN
          ,NULL AS SUM_TOKI_4MON_B_KIN
          ,NULL AS SUM_TOKI_5MON_Y_KIN
          ,NULL AS SUM_TOKI_5MON_B_KIN
          ,NULL AS SUM_TOKI_6MON_Y_KIN
          ,NULL AS SUM_TOKI_6MON_B_KIN
          ,NULL AS SUM_TOKI_TOTAL_Y_KIN
          ,NULL AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS INS_ABBR_NAME
          ,NULL AS PROD_NAME
          ,NULL AS TRADE_TYPE
          ,NULL AS REQ_FLG
          ,NULL AS INS_DEL_FLG
          ,NULL AS INS_CLASS
          ,NULL AS OLD_INSR_FLG
          ,NULL AS JGI_NO
          ,NULL AS JGI_NAME
          ,NULL AS SOS_CD2
          ,NULL AS SOS_CD3
          ,NULL AS ETC_SOS_FLG
          ,NULL AS TARGET_SUMMARY
  </sql>

  <sql id="insTermPlan">
            SELECT IP.CAL_YEAR
                  ,IP.CAL_TERM
                  ,IP.INS_NO
                  ,IP.PROD_CODE
                  ,SUM(IP.PLANNED_2_VALUE_Y) AS PLANNED_TERM_VALUE
              FROM DPM_I_INS_PLAN IP
             WHERE IP.DEL_FLG = 0
               AND IP.CAL_YEAR = #calYear:CHAR#
               AND IP.CAL_TERM = #calTerm:CHAR#
             GROUP BY IP.CAL_YEAR, IP.CAL_TERM, IP.INS_NO, IP.PROD_CODE
  </sql>

  <sql id="targetSummary">
            SELECT CTG.CAL_YEAR
                  ,CTG.CAL_TERM
                  ,CPR.PROD_CODE
              FROM DPM_S_SY_COM_PCAT_PROD CPR
        INNER JOIN DPM_C_PLANNED_CTG CTG
               <isNotEmpty property="jrnsPcatCd">
                ON CPR.PCAT_CODE = #jrnsPcatCd:VARCHAR#
               </isNotEmpty>
               <isEmpty property="jrnsPcatCd">
                ON CPR.PCAT_CODE = CTG.PCAT_CODE
               </isEmpty>
        INNER JOIN DPM_S_SY_COM_PCAT CP
                ON CP.PCAT_CODE = CPR.PCAT_CODE
             WHERE CTG.CAL_YEAR = #calYear:CHAR#
               AND CTG.CAL_TERM = #calTerm:CHAR#
       <isNull property="jrnsCtgList">
       <isNotNull prepend="AND" property="category">
           CTG.CATEGORY = #category:CHAR#
       </isNotNull>
       </isNull>
       <isNotNull property="jrnsCtgList">
       <iterate prepend=" AND CTG.CATEGORY IN " open="(" close=")" conjunction=","  property="jrnsCtgList">
           #jrnsCtgList[]#
       </iterate>
       </isNotNull>
       GROUP BY CTG.CAL_YEAR,CTG.CAL_TERM,CPR.PROD_CODE
  </sql>

  <select id="select" resultMap="resultMap" parameterClass="java.util.Map" >
    SELECT <include refid="column"/>
      FROM DPM_C_INS_M_PLAN IMP
     WHERE IMP.SEQ_KEY = #seqKey:BIGINT#
       AND IMP.CAL_YEAR = #calYear:CHAR#
       AND IMP.CAL_TERM = #calTerm:CHAR#
  </select>

  <select id="selectUk" resultMap="resultMap" parameterClass="jp.co.takeda.model.ManageInsMonthPlan" >
    SELECT <include refid="column"/>
      FROM DPM_C_INS_M_PLAN IMP
     WHERE IMP.CAL_YEAR = #calYear:CHAR#
       AND IMP.CAL_TERM = #calTerm:CHAR#
       AND IMP.PROD_CODE = #prodCode:CHAR#
       AND IMP.INS_NO = #insNo:VARCHAR#
  </select>

  <select id="selectListByProd" resultMap="resultMap" parameterClass="java.util.Map" >
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
  WITH INS_PROD_RECORD AS (
    SELECT RCD.INS_NO INS_NO
          ,CPR.PROD_CODE PROD_CODE
          ,SUM(RCD.TOKI_1MON_Y_KIN) TOKI_1MON_Y_KIN
          ,SUM(RCD.TOKI_1MON_B_KIN) TOKI_1MON_B_KIN
          ,SUM(RCD.TOKI_2MON_Y_KIN) TOKI_2MON_Y_KIN
          ,SUM(RCD.TOKI_2MON_B_KIN) TOKI_2MON_B_KIN
          ,SUM(RCD.TOKI_3MON_Y_KIN) TOKI_3MON_Y_KIN
          ,SUM(RCD.TOKI_3MON_B_KIN) TOKI_3MON_B_KIN
          ,SUM(RCD.TOKI_4MON_Y_KIN) TOKI_4MON_Y_KIN
          ,SUM(RCD.TOKI_4MON_B_KIN) TOKI_4MON_B_KIN
          ,SUM(RCD.TOKI_5MON_Y_KIN) TOKI_5MON_Y_KIN
          ,SUM(RCD.TOKI_5MON_B_KIN) TOKI_5MON_B_KIN
          ,SUM(RCD.TOKI_6MON_Y_KIN) TOKI_6MON_Y_KIN
          ,SUM(RCD.TOKI_6MON_B_KIN) TOKI_6MON_B_KIN
          ,SUM(RCD.TOKI_TOTAL_Y_KIN) TOKI_TOTAL_Y_KIN
          ,SUM(RCD.TOKI_TOTAL_B_KIN) TOKI_TOTAL_B_KIN
      FROM
          DPS_S_SY_V_S_TK05_SST_TKY_Z6K RCD
      <!-- 4月、5月第3営業日まで、10月、11月第3営業日までは実績取得しない -->
      INNER JOIN
      (SELECT *
       FROM DPS_S_SY_COM_CAL T1
       WHERE T1.TODAY = '1'
       AND (
         T1.CAL_MONTH IN('01','02','03','06','07','08','09','12')
         OR (T1.CAL_MONTH IN('05','11') AND T1.CAL_DAY
             > (SELECT CAL_DAY FROM ORADPX01.DPS_S_SY_COM_CAL
                WHERE CAL_YEAR = T1.CAL_YEAR AND CAL_MONTH = T1.CAL_MONTH AND BIZ_DAYS='3')
            )
       )
      )CAL
      ON 1= 1
      INNER JOIN
      <!-- DPM_C_PLANNED_PROD、DPM_C_CPRODを参照する -->
      (
        SELECT
          PROD_CODE,
          STAT_PROD_CODE
        FROM DPM_C_PLANNED_PROD
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
        UNION
        SELECT
          PROD_CODE,
          ORG_STAT_PROD_CODE AS STAT_PROD_CODE
        FROM DPM_C_CPROD CCP
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
      )CPR
      ON CPR.STAT_PROD_CODE = RCD.TTL_TKYHM_K_5_CD
      WHERE
        <isNotNull property="nnuJhoSbt">
           <iterate prepend="RCD.NNU_JHO_SBT IN" open="(" close=")" conjunction=","  property="nnuJhoSbt">
               #nnuJhoSbt[]#
           </iterate>
        </isNotNull>
        <isNotNull property="iykWktKbnList">
           <iterate prepend="AND RCD.IYK_WKT_KBN IN" open="(" close=")" conjunction=","  property="iykWktKbnList">
               #iykWktKbnList[]#
           </iterate>
        </isNotNull>
      GROUP BY
           RCD.INS_NO
          ,CPR.PROD_CODE
  )
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    SELECT IMP.SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
          ,#prodCode:CHAR# AS PROD_CODE
          ,INS.INS_NO
          ,INS_TERM_PLAN.PLANNED_TERM_VALUE
          ,IMP.PLANNED_1_VALUE_YB
          ,IMP.PLANNED_2_VALUE_YB
          ,IMP.PLANNED_3_VALUE_YB
          ,IMP.PLANNED_4_VALUE_YB
          ,IMP.PLANNED_5_VALUE_YB
          ,IMP.PLANNED_6_VALUE_YB
          ,IMP.EXPECTED_1_VALUE_YB
          ,IMP.EXPECTED_2_VALUE_YB
          ,IMP.EXPECTED_3_VALUE_YB
          ,IMP.EXPECTED_4_VALUE_YB
          ,IMP.EXPECTED_5_VALUE_YB
          ,IMP.EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,RECD.TOKI_1MON_Y_KIN
          ,RECD.TOKI_1MON_B_KIN
          ,RECD.TOKI_2MON_Y_KIN
          ,RECD.TOKI_2MON_B_KIN
          ,RECD.TOKI_3MON_Y_KIN
          ,RECD.TOKI_3MON_B_KIN
          ,RECD.TOKI_4MON_Y_KIN
          ,RECD.TOKI_4MON_B_KIN
          ,RECD.TOKI_5MON_Y_KIN
          ,RECD.TOKI_5MON_B_KIN
          ,RECD.TOKI_6MON_Y_KIN
          ,RECD.TOKI_6MON_B_KIN
          ,RECD.TOKI_TOTAL_Y_KIN
          ,RECD.TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,IMP.DEL_FLG
          ,IMP.IS_JGI_NO
          ,IMP.IS_JGI_NAME
          ,IMP.IS_DATE
          ,IMP.IS_PG_ID
          ,IMP.UP_JGI_NO
          ,IMP.UP_JGI_NAME
          ,IMP.UP_DATE
          ,IMP.UP_PG_ID
          ,INS.INS_ABBR_NAME
          ,NULL AS PROD_NAME
          ,INS.TRADE_TYPE
          ,INS.REQ_FLG
          ,INS.DEL_FLG AS INS_DEL_FLG
          ,INS.INS_CLASS
          ,INS.OLD_INSR_FLG
          ,NULL AS JGI_NO
          ,NULL AS JGI_NAME
          ,NULL AS SOS_CD2
          ,NULL AS SOS_CD3
          ,NULL AS ETC_SOS_FLG
          ,DECODE(#tgtInsKb:CHAR#,'1',OINS.HO_INS_TYPE,OINS.HO_INS_TYPE_Z) AS OINS_HO_INS_TYPE
          ,OINS.RELN_INS_NO AS OINS_RELN_INS_NO
          ,NVL(OYK.MAIN_INS_NO,'0') AS MAIN_INS_NO
          ,DECODE(#tgtInsKb:CHAR#,'1',INS.HO_INS_TYPE,INS.HO_INS_TYPE_Z) AS INS_HO_INS_TYPE
          ,INS.RELN_INS_NO
          ,INS.RELN_INS_CODE
          ,NULL AS SUM_PLANNED_TERM_VALUE
          ,NULL AS SUM_PLANNED_1_VALUE_YB
          ,NULL AS SUM_PLANNED_2_VALUE_YB
          ,NULL AS SUM_PLANNED_3_VALUE_YB
          ,NULL AS SUM_PLANNED_4_VALUE_YB
          ,NULL AS SUM_PLANNED_5_VALUE_YB
          ,NULL AS SUM_PLANNED_6_VALUE_YB
          ,NULL AS SUM_EXPECTED_1_VALUE_YB
          ,NULL AS SUM_EXPECTED_2_VALUE_YB
          ,NULL AS SUM_EXPECTED_3_VALUE_YB
          ,NULL AS SUM_EXPECTED_4_VALUE_YB
          ,NULL AS SUM_EXPECTED_5_VALUE_YB
          ,NULL AS SUM_EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS SUM_TOKI_1MON_Y_KIN
          ,NULL AS SUM_TOKI_1MON_B_KIN
          ,NULL AS SUM_TOKI_2MON_Y_KIN
          ,NULL AS SUM_TOKI_2MON_B_KIN
          ,NULL AS SUM_TOKI_3MON_Y_KIN
          ,NULL AS SUM_TOKI_3MON_B_KIN
          ,NULL AS SUM_TOKI_4MON_Y_KIN
          ,NULL AS SUM_TOKI_4MON_B_KIN
          ,NULL AS SUM_TOKI_5MON_Y_KIN
          ,NULL AS SUM_TOKI_5MON_B_KIN
          ,NULL AS SUM_TOKI_6MON_Y_KIN
          ,NULL AS SUM_TOKI_6MON_B_KIN
          ,NULL AS SUM_TOKI_TOTAL_Y_KIN
          ,NULL AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS ADDR_CODE_PREF
          ,NULL AS ADDR_CODE_CITY
          ,NULL AS SHIKUCHOSON_MEI_KJ
          ,NULL AS ACTIVITY_TYPE
          ,NULL AS TARGET_SUMMARY
      FROM DPM_C_VI_INS_MST INS
           LEFT JOIN DPM_C_SY_COM_INS_OYAKO OYK ON OYK.INS_NO = INS.INS_NO
                                           AND OYK.OYAKO_KB = #oyakoKb:CHAR#
           LEFT JOIN DPM_C_VI_INS_MST OINS ON NVL(OYK.MAIN_INS_NO,OYK.INS_NO) = OINS.INS_NO
                                           AND OYK.OYAKO_KB = #oyakoKb:CHAR#
           INNER JOIN DPM_C_MR_INS_PROD MIP ON INS.INS_NO = MIP.INS_NO
           LEFT JOIN DPM_C_INS_M_PLAN IMP  ON INS.INS_NO = IMP.INS_NO
              AND IMP.CAL_YEAR = '$calYear$'
              AND IMP.CAL_TERM = '$calTerm.dbValue$'
              AND IMP.PROD_CODE = #prodCode:CHAR#
              AND INS.HO_INS_TYPE != '4'
              AND IMP.DEL_FLG = '0'
           LEFT JOIN (<include refid="insTermPlan"/>) INS_TERM_PLAN
           ON INS_TERM_PLAN.INS_NO = INS.INS_NO
              AND INS_TERM_PLAN.PROD_CODE =  #prodCode:CHAR#
              AND INS_TERM_PLAN.CAL_YEAR = '$calYear$'
              AND INS_TERM_PLAN.CAL_TERM = '$calTerm.dbValue$'
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          LEFT JOIN INS_PROD_RECORD RECD
          ON RECD.INS_NO = INS.INS_NO
             AND RECD.PROD_CODE = #prodCode:CHAR#
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
     WHERE
           MIP.MR_NO = #jgiNo:INTEGER#
       AND MIP.PROD_CODE = #prodCode:CHAR#
       AND INS.HO_INS_TYPE != '4'
       <isNotNull property="hoInsTypeList">
           <!-- <iterate prepend="AND INS.HO_INS_TYPE IN" open="(" close=")" conjunction=","  property="hoInsTypeList"> -->
           <!-- NSG親子紐づけ -->
           <iterate prepend="AND NVL(OINS.HO_INS_TYPE, INS.HO_INS_TYPE) IN" open="(" close=")" conjunction=","  property="hoInsTypeList">
               #hoInsTypeList[].dbValue#
           </iterate>
       </isNotNull>
       <isNotNull property="relnInsNo" prepend="AND">
           INS.RELN_INS_NO = #relnInsNo:VARCHAR#
       </isNotNull>
    <isPropertyAvailable property="sortString">
      $sortString$
    </isPropertyAvailable>
  </select>

  <select id="selectListByProdForVac" resultMap="resultMap" parameterClass="java.util.Map" >
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
  WITH INS_PROD_RECORD AS (
    SELECT RCD.INS_NO INS_NO
          ,CPR.PROD_CODE PROD_CODE
          ,SUM(RCD.TOKI_1MON_Y_KIN) TOKI_1MON_Y_KIN
          ,SUM(RCD.TOKI_1MON_B_KIN) TOKI_1MON_B_KIN
          ,SUM(RCD.TOKI_2MON_Y_KIN) TOKI_2MON_Y_KIN
          ,SUM(RCD.TOKI_2MON_B_KIN) TOKI_2MON_B_KIN
          ,SUM(RCD.TOKI_3MON_Y_KIN) TOKI_3MON_Y_KIN
          ,SUM(RCD.TOKI_3MON_B_KIN) TOKI_3MON_B_KIN
          ,SUM(RCD.TOKI_4MON_Y_KIN) TOKI_4MON_Y_KIN
          ,SUM(RCD.TOKI_4MON_B_KIN) TOKI_4MON_B_KIN
          ,SUM(RCD.TOKI_5MON_Y_KIN) TOKI_5MON_Y_KIN
          ,SUM(RCD.TOKI_5MON_B_KIN) TOKI_5MON_B_KIN
          ,SUM(RCD.TOKI_6MON_Y_KIN) TOKI_6MON_Y_KIN
          ,SUM(RCD.TOKI_6MON_B_KIN) TOKI_6MON_B_KIN
          ,SUM(RCD.TOKI_TOTAL_Y_KIN) TOKI_TOTAL_Y_KIN
          ,SUM(RCD.TOKI_TOTAL_B_KIN) TOKI_TOTAL_B_KIN
      FROM
          DPS_S_SY_V_S_TK05_SST_TKY_Z6K RCD
      <!-- 4月、5月第3営業日まで、10月、11月第3営業日までは実績取得しない -->
      INNER JOIN
      (SELECT *
       FROM DPS_S_SY_COM_CAL T1
       WHERE T1.TODAY = '1'
       AND (
         T1.CAL_MONTH IN('01','02','03','06','07','08','09','12')
         OR (T1.CAL_MONTH IN('05','11') AND T1.CAL_DAY
             > (SELECT CAL_DAY FROM ORADPX01.DPS_S_SY_COM_CAL
                WHERE CAL_YEAR = T1.CAL_YEAR AND CAL_MONTH = T1.CAL_MONTH AND BIZ_DAYS='3')
            )
       )
      )CAL
      ON 1= 1
      INNER JOIN
      <!-- DPM_C_PLANNED_PROD、DPM_C_CPRODを参照する -->
      (
        SELECT
          PROD_CODE,
          STAT_PROD_CODE
        FROM DPM_C_PLANNED_PROD
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
        UNION
        SELECT
          PROD_CODE,
          ORG_STAT_PROD_CODE AS STAT_PROD_CODE
        FROM DPM_C_CPROD CCP
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
      )CPR
      ON CPR.STAT_PROD_CODE = RCD.TTL_TKYHM_K_5_CD
      WHERE
        <isNotNull property="nnuJhoSbt">
           <iterate prepend="RCD.NNU_JHO_SBT IN" open="(" close=")" conjunction=","  property="nnuJhoSbt">
               #nnuJhoSbt[]#
           </iterate>
        </isNotNull>
        <isNotNull property="iykWktKbnList">
           <iterate prepend="AND RCD.IYK_WKT_KBN IN" open="(" close=")" conjunction=","  property="iykWktKbnList">
               #iykWktKbnList[]#
           </iterate>
        </isNotNull>
        <isNotNull property="insNo" prepend="AND">
               RCD.INS_NO = #insNo:VARCHAR#
        </isNotNull>
      GROUP BY
           RCD.INS_NO
          ,CPR.PROD_CODE
  )
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    SELECT IMP.SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
<!-- mod Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
          <!--,IMP.PROD_CODE -->
          <!--,IMP.INS_NO -->
          ,#prodCode:CHAR# AS PROD_CODE
          ,INS.INS_NO
<!-- mod End 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
          ,INS_TERM_PLAN.PLANNED_TERM_VALUE
          ,IMP.PLANNED_1_VALUE_YB
          ,IMP.PLANNED_2_VALUE_YB
          ,IMP.PLANNED_3_VALUE_YB
          ,IMP.PLANNED_4_VALUE_YB
          ,IMP.PLANNED_5_VALUE_YB
          ,IMP.PLANNED_6_VALUE_YB
          ,IMP.EXPECTED_1_VALUE_YB
          ,IMP.EXPECTED_2_VALUE_YB
          ,IMP.EXPECTED_3_VALUE_YB
          ,IMP.EXPECTED_4_VALUE_YB
          ,IMP.EXPECTED_5_VALUE_YB
          ,IMP.EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,RECD.TOKI_1MON_Y_KIN
          ,RECD.TOKI_1MON_B_KIN
          ,RECD.TOKI_2MON_Y_KIN
          ,RECD.TOKI_2MON_B_KIN
          ,RECD.TOKI_3MON_Y_KIN
          ,RECD.TOKI_3MON_B_KIN
          ,RECD.TOKI_4MON_Y_KIN
          ,RECD.TOKI_4MON_B_KIN
          ,RECD.TOKI_5MON_Y_KIN
          ,RECD.TOKI_5MON_B_KIN
          ,RECD.TOKI_6MON_Y_KIN
          ,RECD.TOKI_6MON_B_KIN
          ,RECD.TOKI_TOTAL_Y_KIN
          ,RECD.TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,IMP.DEL_FLG
          ,IMP.IS_JGI_NO
          ,IMP.IS_JGI_NAME
          ,IMP.IS_DATE
          ,IMP.IS_PG_ID
          ,IMP.UP_JGI_NO
          ,IMP.UP_JGI_NAME
          ,IMP.UP_DATE
          ,IMP.UP_PG_ID
          ,INS.INS_ABBR_NAME
          ,NULL AS PROD_NAME
          ,INS.TRADE_TYPE
          ,INS.REQ_FLG
          ,INS.DEL_FLG AS INS_DEL_FLG
          ,NULL AS INS_CLASS
          ,NULL AS OLD_INSR_FLG
          ,NULL AS JGI_NO
          ,NULL AS JGI_NAME
          ,NULL AS SOS_CD2
          ,NULL AS SOS_CD3
          ,NULL AS ETC_SOS_FLG
          ,DECODE(#tgtInsKb:CHAR#,'1',OINS.HO_INS_TYPE,OINS.HO_INS_TYPE_Z) AS OINS_HO_INS_TYPE
          ,OINS.RELN_INS_NO AS OINS_RELN_INS_NO
          ,NVL(OYK.MAIN_INS_NO,'0') AS MAIN_INS_NO
          ,DECODE(#tgtInsKb:CHAR#,'1',INS.HO_INS_TYPE,INS.HO_INS_TYPE_Z) AS INS_HO_INS_TYPE
          ,INS.RELN_INS_NO
          ,INS.RELN_INS_CODE
          ,NULL AS SUM_PLANNED_TERM_VALUE
          ,NULL AS SUM_PLANNED_1_VALUE_YB
          ,NULL AS SUM_PLANNED_2_VALUE_YB
          ,NULL AS SUM_PLANNED_3_VALUE_YB
          ,NULL AS SUM_PLANNED_4_VALUE_YB
          ,NULL AS SUM_PLANNED_5_VALUE_YB
          ,NULL AS SUM_PLANNED_6_VALUE_YB
          ,NULL AS SUM_EXPECTED_1_VALUE_YB
          ,NULL AS SUM_EXPECTED_2_VALUE_YB
          ,NULL AS SUM_EXPECTED_3_VALUE_YB
          ,NULL AS SUM_EXPECTED_4_VALUE_YB
          ,NULL AS SUM_EXPECTED_5_VALUE_YB
          ,NULL AS SUM_EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS SUM_TOKI_1MON_Y_KIN
          ,NULL AS SUM_TOKI_1MON_B_KIN
          ,NULL AS SUM_TOKI_2MON_Y_KIN
          ,NULL AS SUM_TOKI_2MON_B_KIN
          ,NULL AS SUM_TOKI_3MON_Y_KIN
          ,NULL AS SUM_TOKI_3MON_B_KIN
          ,NULL AS SUM_TOKI_4MON_Y_KIN
          ,NULL AS SUM_TOKI_4MON_B_KIN
          ,NULL AS SUM_TOKI_5MON_Y_KIN
          ,NULL AS SUM_TOKI_5MON_B_KIN
          ,NULL AS SUM_TOKI_6MON_Y_KIN
          ,NULL AS SUM_TOKI_6MON_B_KIN
          ,NULL AS SUM_TOKI_TOTAL_Y_KIN
          ,NULL AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,INS.ADDR_CODE_PREF
          ,INS.ADDR_CODE_CITY
          ,JIS.SHIKUCHOSON_MEI_KJ
          ,AT.ACTIVITY_TYPE
          ,NULL AS TARGET_SUMMARY
      FROM DPM_C_VI_INS_MST INS
           LEFT JOIN DPM_C_SY_COM_INS_OYAKO OYK ON OYK.INS_NO = INS.INS_NO
                                           AND OYK.OYAKO_KB = #oyakoKb:CHAR#
           LEFT JOIN DPM_C_VI_INS_MST OINS ON NVL(OYK.MAIN_INS_NO,OYK.INS_NO) = OINS.INS_NO
                                           AND OYK.OYAKO_KB = #oyakoKb:CHAR#
           INNER JOIN DPM_C_MR_INS_PROD MIP ON INS.INS_NO = MIP.INS_NO
           LEFT JOIN DPM_C_INS_M_PLAN IMP  ON INS.INS_NO = IMP.INS_NO
       AND IMP.CAL_YEAR = #calYear:CHAR#
       AND IMP.CAL_TERM = #calTerm:CHAR#
       AND IMP.PROD_CODE = #prodCode:CHAR#
<!-- add Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
       AND IMP.DEL_FLG = '0'
<!-- add End 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
           LEFT JOIN (<include refid="insTermPlan"/>) INS_TERM_PLAN
<!-- mod Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
<!--           ON INS_TERM_PLAN.INS_NO = IMP.INS_NO
              AND INS_TERM_PLAN.PROD_CODE = IMP.PROD_CODE-->
           ON INS_TERM_PLAN.INS_NO = INS.INS_NO
              AND INS_TERM_PLAN.PROD_CODE = #prodCode:CHAR#
<!-- mod End 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
              AND INS_TERM_PLAN.CAL_YEAR = '$calYear$'
              AND INS_TERM_PLAN.CAL_TERM = '$calTerm.dbValue$'
           INNER JOIN DPS_S_SY_T_JIS_MST JIS
               ON  INS.ADDR_CODE_PREF = JIS.TODOUFUKEN_CD
               AND INS.ADDR_CODE_CITY = JIS.SHIKUCHOSON_CD
<!-- mod Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
           <!-- INNER JOIN DPM_V_VI_ACTIVITY_TYPE AT -->
           LEFT JOIN DPM_V_VI_ACTIVITY_TYPE AT
<!-- mod Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
              ON  IMP.INS_NO = AT.INS_NO
              AND IMP.CAL_YEAR = AT.CAL_YEAR
              AND IMP.CAL_TERM = AT.CAL_TERM
<!-- add Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
           LEFT JOIN DPM_V_VI_ACTIVITY_TYPE AT2
              ON  INS_TERM_PLAN.INS_NO = AT2.INS_NO
              AND INS_TERM_PLAN.CAL_YEAR = AT2.CAL_YEAR
              AND INS_TERM_PLAN.CAL_TERM = AT2.CAL_TERM
<!-- add End 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          LEFT JOIN INS_PROD_RECORD RECD
             ON RECD.INS_NO = INS.INS_NO
             AND RECD.PROD_CODE = #prodCode:CHAR#
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
     WHERE MIP.MR_NO = #jgiNo:INTEGER#
       AND MIP.PROD_CODE = #prodCode:CHAR#
       AND MIP.MAIN_MR = '0'
<!-- del Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
       <!--AND IMP.DEL_FLG = '0'-->
<!-- del End 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
       <isNotNull property="insNo" prepend="AND">
           INS.INS_NO = #insNo:VARCHAR#
       </isNotNull>
       <isNotNull property="addrCodePref" prepend="AND">
           INS.ADDR_CODE_PREF = #addrCodePref:VARCHAR#
       </isNotNull>
       <isNotNull property="addrCodeCity" prepend="AND">
           INS.ADDR_CODE_CITY = #addrCodeCity:VARCHAR#
       </isNotNull>
       <isNotNull property="activityType" prepend="AND">
           <!-- mod Start 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
           <!--AT.ACTIVITY_TYPE = #activityType:CHAR#-->
           (AT.ACTIVITY_TYPE = #activityType:CHAR# OR AT2.ACTIVITY_TYPE = #activityType:CHAR#)
           <!-- mod End 2022/10/12 H.futagami 期別の施設別計画があるが明細行が表示されない -->
       </isNotNull>
    <isPropertyAvailable property="sortString">
      $sortString$
    </isPropertyAvailable>
  </select>


 <select id="selectSumByIns" resultMap="resultMap" parameterClass="java.util.Map" >
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
  WITH INS_PROD_RECORD AS (
    SELECT RCD.INS_NO INS_NO
          ,CPR.PROD_CODE PROD_CODE
          ,SUM(RCD.TOKI_1MON_Y_KIN) TOKI_1MON_Y_KIN
          ,SUM(RCD.TOKI_1MON_B_KIN) TOKI_1MON_B_KIN
          ,SUM(RCD.TOKI_2MON_Y_KIN) TOKI_2MON_Y_KIN
          ,SUM(RCD.TOKI_2MON_B_KIN) TOKI_2MON_B_KIN
          ,SUM(RCD.TOKI_3MON_Y_KIN) TOKI_3MON_Y_KIN
          ,SUM(RCD.TOKI_3MON_B_KIN) TOKI_3MON_B_KIN
          ,SUM(RCD.TOKI_4MON_Y_KIN) TOKI_4MON_Y_KIN
          ,SUM(RCD.TOKI_4MON_B_KIN) TOKI_4MON_B_KIN
          ,SUM(RCD.TOKI_5MON_Y_KIN) TOKI_5MON_Y_KIN
          ,SUM(RCD.TOKI_5MON_B_KIN) TOKI_5MON_B_KIN
          ,SUM(RCD.TOKI_6MON_Y_KIN) TOKI_6MON_Y_KIN
          ,SUM(RCD.TOKI_6MON_B_KIN) TOKI_6MON_B_KIN
          ,SUM(RCD.TOKI_TOTAL_Y_KIN) TOKI_TOTAL_Y_KIN
          ,SUM(RCD.TOKI_TOTAL_B_KIN) TOKI_TOTAL_B_KIN
      FROM
          DPS_S_SY_V_S_TK05_SST_TKY_Z6K RCD
      <!-- 4月、5月第3営業日まで、10月、11月第3営業日までは実績取得しない -->
      INNER JOIN
      (SELECT *
       FROM DPS_S_SY_COM_CAL T1
       WHERE T1.TODAY = '1'
       AND (
         T1.CAL_MONTH IN('01','02','03','06','07','08','09','12')
         OR (T1.CAL_MONTH IN('05','11') AND T1.CAL_DAY
             > (SELECT CAL_DAY FROM ORADPX01.DPS_S_SY_COM_CAL
                WHERE CAL_YEAR = T1.CAL_YEAR AND CAL_MONTH = T1.CAL_MONTH AND BIZ_DAYS='3')
            )
       )
      )CAL
      ON 1= 1
      INNER JOIN
      <!-- DPM_C_PLANNED_PROD、DPM_C_CPRODを参照する -->
      (
        SELECT
          PROD_CODE,
          STAT_PROD_CODE
        FROM DPM_C_PLANNED_PROD
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
        UNION
        SELECT
          PROD_CODE,
          ORG_STAT_PROD_CODE AS STAT_PROD_CODE
        FROM DPM_C_CPROD CCP
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
      )CPR
      ON CPR.STAT_PROD_CODE = RCD.TTL_TKYHM_K_5_CD
      WHERE
        <isNotNull property="nnuJhoSbt">
           <iterate prepend="RCD.NNU_JHO_SBT IN" open="(" close=")" conjunction=","  property="nnuJhoSbt">
               #nnuJhoSbt[]#
           </iterate>
        </isNotNull>
        <isNotNull property="iykWktKbnList">
           <iterate prepend="AND RCD.IYK_WKT_KBN IN" open="(" close=")" conjunction=","  property="iykWktKbnList">
               #iykWktKbnList[]#
           </iterate>
        </isNotNull>
      GROUP BY
           RCD.INS_NO
          ,CPR.PROD_CODE
  )
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    SELECT
        NULL AS SEQ_KEY
       ,NULL AS CAL_YEAR
       ,NULL AS CAL_TERM
       ,NULL AS PROD_CODE
       ,NULL AS INS_NO
       ,NULL AS PLANNED_TERM_VALUE
       ,NULL AS PLANNED_1_VALUE_YB
       ,NULL AS PLANNED_2_VALUE_YB
       ,NULL AS PLANNED_3_VALUE_YB
       ,NULL AS PLANNED_4_VALUE_YB
       ,NULL AS PLANNED_5_VALUE_YB
       ,NULL AS PLANNED_6_VALUE_YB
       ,NULL AS EXPECTED_1_VALUE_YB
       ,NULL AS EXPECTED_2_VALUE_YB
       ,NULL AS EXPECTED_3_VALUE_YB
       ,NULL AS EXPECTED_4_VALUE_YB
       ,NULL AS EXPECTED_5_VALUE_YB
       ,NULL AS EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,NULL AS TOKI_1MON_Y_KIN
       ,NULL AS TOKI_1MON_B_KIN
       ,NULL AS TOKI_2MON_Y_KIN
       ,NULL AS TOKI_2MON_B_KIN
       ,NULL AS TOKI_3MON_Y_KIN
       ,NULL AS TOKI_3MON_B_KIN
       ,NULL AS TOKI_4MON_Y_KIN
       ,NULL AS TOKI_4MON_B_KIN
       ,NULL AS TOKI_5MON_Y_KIN
       ,NULL AS TOKI_5MON_B_KIN
       ,NULL AS TOKI_6MON_Y_KIN
       ,NULL AS TOKI_6MON_B_KIN
       ,NULL AS TOKI_TOTAL_Y_KIN
       ,NULL AS TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,NULL AS DEL_FLG
       ,NULL AS IS_JGI_NO
       ,NULL AS IS_JGI_NAME
       ,NULL AS IS_DATE
       ,NULL AS IS_PG_ID
       ,NULL AS UP_JGI_NO
       ,NULL AS UP_JGI_NAME
       ,NULL AS UP_DATE
       ,NULL AS UP_PG_ID
       ,NULL AS INS_ABBR_NAME
       ,NULL AS PROD_NAME
       ,NULL AS TRADE_TYPE
       ,NULL AS REQ_FLG
       ,NULL AS INS_DEL_FLG
       ,NULL AS INS_CLASS
       ,NULL AS OLD_INSR_FLG
       ,NULL AS JGI_NO
       ,NULL AS JGI_NAME
       ,NULL AS SOS_CD2
       ,NULL AS SOS_CD3
       ,NULL AS ETC_SOS_FLG
       ,SUM(INS_TERM_PLAN.PLANNED_TERM_VALUE) AS SUM_PLANNED_TERM_VALUE
       ,SUM(IMP.PLANNED_1_VALUE_YB) AS SUM_PLANNED_1_VALUE_YB
       ,SUM(IMP.PLANNED_2_VALUE_YB) AS SUM_PLANNED_2_VALUE_YB
       ,SUM(IMP.PLANNED_3_VALUE_YB) AS SUM_PLANNED_3_VALUE_YB
       ,SUM(IMP.PLANNED_4_VALUE_YB) AS SUM_PLANNED_4_VALUE_YB
       ,SUM(IMP.PLANNED_5_VALUE_YB) AS SUM_PLANNED_5_VALUE_YB
       ,SUM(IMP.PLANNED_6_VALUE_YB) AS SUM_PLANNED_6_VALUE_YB
       ,SUM(IMP.EXPECTED_1_VALUE_YB) AS SUM_EXPECTED_1_VALUE_YB
       ,SUM(IMP.EXPECTED_2_VALUE_YB) AS SUM_EXPECTED_2_VALUE_YB
       ,SUM(IMP.EXPECTED_3_VALUE_YB) AS SUM_EXPECTED_3_VALUE_YB
       ,SUM(IMP.EXPECTED_4_VALUE_YB) AS SUM_EXPECTED_4_VALUE_YB
       ,SUM(IMP.EXPECTED_5_VALUE_YB) AS SUM_EXPECTED_5_VALUE_YB
       ,SUM(IMP.EXPECTED_6_VALUE_YB) AS SUM_EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,SUM(RECD.TOKI_1MON_Y_KIN) AS SUM_TOKI_1MON_Y_KIN
       ,SUM(RECD.TOKI_1MON_B_KIN) AS SUM_TOKI_1MON_B_KIN
       ,SUM(RECD.TOKI_2MON_Y_KIN) AS SUM_TOKI_2MON_Y_KIN
       ,SUM(RECD.TOKI_2MON_B_KIN) AS SUM_TOKI_2MON_B_KIN
       ,SUM(RECD.TOKI_3MON_Y_KIN) AS SUM_TOKI_3MON_Y_KIN
       ,SUM(RECD.TOKI_3MON_B_KIN) AS SUM_TOKI_3MON_B_KIN
       ,SUM(RECD.TOKI_4MON_Y_KIN) AS SUM_TOKI_4MON_Y_KIN
       ,SUM(RECD.TOKI_4MON_B_KIN) AS SUM_TOKI_4MON_B_KIN
       ,SUM(RECD.TOKI_5MON_Y_KIN) AS SUM_TOKI_5MON_Y_KIN
       ,SUM(RECD.TOKI_5MON_B_KIN) AS SUM_TOKI_5MON_B_KIN
       ,SUM(RECD.TOKI_6MON_Y_KIN) AS SUM_TOKI_6MON_Y_KIN
       ,SUM(RECD.TOKI_6MON_B_KIN) AS SUM_TOKI_6MON_B_KIN
       ,SUM(RECD.TOKI_TOTAL_Y_KIN) AS SUM_TOKI_TOTAL_Y_KIN
       ,SUM(RECD.TOKI_TOTAL_B_KIN) AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,NULL AS ADDR_CODE_PREF
       ,NULL AS ADDR_CODE_CITY
       ,NULL AS SHIKUCHOSON_MEI_KJ
       ,NULL AS ACTIVITY_TYPE
       ,NULL AS TARGET_SUMMARY
    FROM
        DPM_C_VI_INS_MST INS
        INNER JOIN DPM_C_MR_INS_PROD MIP ON INS.INS_NO = MIP.INS_NO
        LEFT  JOIN DPM_C_INS_M_PLAN IMP  ON INS.INS_NO = IMP.INS_NO
               AND IMP.CAL_YEAR = '$calYear$'
               AND IMP.CAL_TERM = '$calTerm.dbValue$'
               AND IMP.PROD_CODE = #prodCode:CHAR#
               AND IMP.DEL_FLG = '0'
        LEFT JOIN (<include refid="insTermPlan"/>) INS_TERM_PLAN
           ON INS_TERM_PLAN.INS_NO = IMP.INS_NO
              AND INS_TERM_PLAN.PROD_CODE = IMP.PROD_CODE
              AND INS_TERM_PLAN.CAL_YEAR = '$calYear$'
              AND INS_TERM_PLAN.CAL_TERM = '$calTerm.dbValue$'
		LEFT JOIN DPM_C_SY_COM_INS_OYAKO OYK ON OYK.INS_NO = INS.INS_NO
				AND OYK.OYAKO_KB = #oyakoKb:CHAR#
		LEFT JOIN DPM_C_VI_INS_MST OINS ON NVL(OYK.MAIN_INS_NO,OYK.INS_NO) = OINS.INS_NO
				AND OYK.OYAKO_KB = #oyakoKb:CHAR#
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
         LEFT JOIN INS_PROD_RECORD RECD
             ON RECD.INS_NO = INS.INS_NO
             AND RECD.PROD_CODE = #prodCode:CHAR#
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
     WHERE
         MIP.MR_NO = #jgiNo:INTEGER#
     AND MIP.PROD_CODE = #prodCode:CHAR#
     AND INS.HO_INS_TYPE != '4'
       <isNotNull property="hoInsTypeList">
           <!-- <iterate prepend="AND INS.HO_INS_TYPE IN" open="(" close=")" conjunction=","  property="hoInsTypeList"> -->
           <!-- NSG親子紐づけ -->
           <iterate prepend="AND NVL(OINS.HO_INS_TYPE, INS.HO_INS_TYPE) IN" open="(" close=")" conjunction=","  property="hoInsTypeList">
               #hoInsTypeList[].dbValue#
           </iterate>
       </isNotNull>
  </select>

 <select id="selectSumByInsForVac" resultMap="resultMap" parameterClass="java.util.Map" >
<!-- mod End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
  WITH INS_PROD_RECORD AS (
    SELECT RCD.INS_NO INS_NO
          ,CPR.PROD_CODE PROD_CODE
          ,SUM(RCD.TOKI_1MON_Y_KIN) TOKI_1MON_Y_KIN
          ,SUM(RCD.TOKI_1MON_B_KIN) TOKI_1MON_B_KIN
          ,SUM(RCD.TOKI_2MON_Y_KIN) TOKI_2MON_Y_KIN
          ,SUM(RCD.TOKI_2MON_B_KIN) TOKI_2MON_B_KIN
          ,SUM(RCD.TOKI_3MON_Y_KIN) TOKI_3MON_Y_KIN
          ,SUM(RCD.TOKI_3MON_B_KIN) TOKI_3MON_B_KIN
          ,SUM(RCD.TOKI_4MON_Y_KIN) TOKI_4MON_Y_KIN
          ,SUM(RCD.TOKI_4MON_B_KIN) TOKI_4MON_B_KIN
          ,SUM(RCD.TOKI_5MON_Y_KIN) TOKI_5MON_Y_KIN
          ,SUM(RCD.TOKI_5MON_B_KIN) TOKI_5MON_B_KIN
          ,SUM(RCD.TOKI_6MON_Y_KIN) TOKI_6MON_Y_KIN
          ,SUM(RCD.TOKI_6MON_B_KIN) TOKI_6MON_B_KIN
          ,SUM(RCD.TOKI_TOTAL_Y_KIN) TOKI_TOTAL_Y_KIN
          ,SUM(RCD.TOKI_TOTAL_B_KIN) TOKI_TOTAL_B_KIN
      FROM
          DPS_S_SY_V_S_TK05_SST_TKY_Z6K RCD
      <!-- 4月、5月第3営業日まで、10月、11月第3営業日までは実績取得しない -->
      INNER JOIN
      (SELECT *
       FROM DPS_S_SY_COM_CAL T1
       WHERE T1.TODAY = '1'
       AND (
         T1.CAL_MONTH IN('01','02','03','06','07','08','09','12')
         OR (T1.CAL_MONTH IN('05','11') AND T1.CAL_DAY
             > (SELECT CAL_DAY FROM ORADPX01.DPS_S_SY_COM_CAL
                WHERE CAL_YEAR = T1.CAL_YEAR AND CAL_MONTH = T1.CAL_MONTH AND BIZ_DAYS='3')
            )
       )
      )CAL
      ON 1= 1
      INNER JOIN
      <!-- DPM_C_PLANNED_PROD、DPM_C_CPRODを参照する -->
      (
        SELECT
          PROD_CODE,
          STAT_PROD_CODE
        FROM DPM_C_PLANNED_PROD
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
        UNION
        SELECT
          PROD_CODE,
          ORG_STAT_PROD_CODE AS STAT_PROD_CODE
        FROM DPM_C_CPROD CCP
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
      )CPR
      ON CPR.STAT_PROD_CODE = RCD.TTL_TKYHM_K_5_CD
      WHERE
        <isNotNull property="nnuJhoSbt">
           <iterate prepend="RCD.NNU_JHO_SBT IN" open="(" close=")" conjunction=","  property="nnuJhoSbt">
               #nnuJhoSbt[]#
           </iterate>
        </isNotNull>
        <isNotNull property="iykWktKbnList">
           <iterate prepend="AND RCD.IYK_WKT_KBN IN" open="(" close=")" conjunction=","  property="iykWktKbnList">
               #iykWktKbnList[]#
           </iterate>
        </isNotNull>
      GROUP BY
           RCD.INS_NO
          ,CPR.PROD_CODE
  )
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
      SELECT
        NULL AS SEQ_KEY
       ,NULL AS CAL_YEAR
       ,NULL AS CAL_TERM
       ,NULL AS PROD_CODE
       ,NULL AS INS_NO
       ,NULL AS PLANNED_TERM_VALUE
       ,NULL AS PLANNED_1_VALUE_YB
       ,NULL AS PLANNED_2_VALUE_YB
       ,NULL AS PLANNED_3_VALUE_YB
       ,NULL AS PLANNED_4_VALUE_YB
       ,NULL AS PLANNED_5_VALUE_YB
       ,NULL AS PLANNED_6_VALUE_YB
       ,NULL AS EXPECTED_1_VALUE_YB
       ,NULL AS EXPECTED_2_VALUE_YB
       ,NULL AS EXPECTED_3_VALUE_YB
       ,NULL AS EXPECTED_4_VALUE_YB
       ,NULL AS EXPECTED_5_VALUE_YB
       ,NULL AS EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,NULL AS TOKI_1MON_Y_KIN
       ,NULL AS TOKI_1MON_B_KIN
       ,NULL AS TOKI_2MON_Y_KIN
       ,NULL AS TOKI_2MON_B_KIN
       ,NULL AS TOKI_3MON_Y_KIN
       ,NULL AS TOKI_3MON_B_KIN
       ,NULL AS TOKI_4MON_Y_KIN
       ,NULL AS TOKI_4MON_B_KIN
       ,NULL AS TOKI_5MON_Y_KIN
       ,NULL AS TOKI_5MON_B_KIN
       ,NULL AS TOKI_6MON_Y_KIN
       ,NULL AS TOKI_6MON_B_KIN
       ,NULL AS TOKI_TOTAL_Y_KIN
       ,NULL AS TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,NULL AS DEL_FLG
       ,NULL AS IS_JGI_NO
       ,NULL AS IS_JGI_NAME
       ,NULL AS IS_DATE
       ,NULL AS IS_PG_ID
       ,NULL AS UP_JGI_NO
       ,NULL AS UP_JGI_NAME
       ,NULL AS UP_DATE
       ,NULL AS UP_PG_ID
       ,NULL AS INS_ABBR_NAME
       ,NULL AS PROD_NAME
       ,NULL AS TRADE_TYPE
       ,NULL AS REQ_FLG
       ,NULL AS INS_DEL_FLG
       ,NULL AS INS_CLASS
       ,NULL AS OLD_INSR_FLG
       ,NULL AS JGI_NO
       ,NULL AS JGI_NAME
       ,NULL AS SOS_CD2
       ,NULL AS SOS_CD3
       ,NULL AS ETC_SOS_FLG
       ,SUM(INS_TERM_PLAN.PLANNED_TERM_VALUE) AS SUM_PLANNED_TERM_VALUE
       ,SUM(IMP.PLANNED_1_VALUE_YB) AS SUM_PLANNED_1_VALUE_YB
       ,SUM(IMP.PLANNED_2_VALUE_YB) AS SUM_PLANNED_2_VALUE_YB
       ,SUM(IMP.PLANNED_3_VALUE_YB) AS SUM_PLANNED_3_VALUE_YB
       ,SUM(IMP.PLANNED_4_VALUE_YB) AS SUM_PLANNED_4_VALUE_YB
       ,SUM(IMP.PLANNED_5_VALUE_YB) AS SUM_PLANNED_5_VALUE_YB
       ,SUM(IMP.PLANNED_6_VALUE_YB) AS SUM_PLANNED_6_VALUE_YB
       ,SUM(IMP.EXPECTED_1_VALUE_YB) AS SUM_EXPECTED_1_VALUE_YB
       ,SUM(IMP.EXPECTED_2_VALUE_YB) AS SUM_EXPECTED_2_VALUE_YB
       ,SUM(IMP.EXPECTED_3_VALUE_YB) AS SUM_EXPECTED_3_VALUE_YB
       ,SUM(IMP.EXPECTED_4_VALUE_YB) AS SUM_EXPECTED_4_VALUE_YB
       ,SUM(IMP.EXPECTED_5_VALUE_YB) AS SUM_EXPECTED_5_VALUE_YB
       ,SUM(IMP.EXPECTED_6_VALUE_YB) AS SUM_EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,SUM(RECD.TOKI_1MON_Y_KIN) AS SUM_TOKI_1MON_Y_KIN
       ,SUM(RECD.TOKI_1MON_B_KIN) AS SUM_TOKI_1MON_B_KIN
       ,SUM(RECD.TOKI_2MON_Y_KIN) AS SUM_TOKI_2MON_Y_KIN
       ,SUM(RECD.TOKI_2MON_B_KIN) AS SUM_TOKI_2MON_B_KIN
       ,SUM(RECD.TOKI_3MON_Y_KIN) AS SUM_TOKI_3MON_Y_KIN
       ,SUM(RECD.TOKI_3MON_B_KIN) AS SUM_TOKI_3MON_B_KIN
       ,SUM(RECD.TOKI_4MON_Y_KIN) AS SUM_TOKI_4MON_Y_KIN
       ,SUM(RECD.TOKI_4MON_B_KIN) AS SUM_TOKI_4MON_B_KIN
       ,SUM(RECD.TOKI_5MON_Y_KIN) AS SUM_TOKI_5MON_Y_KIN
       ,SUM(RECD.TOKI_5MON_B_KIN) AS SUM_TOKI_5MON_B_KIN
       ,SUM(RECD.TOKI_6MON_Y_KIN) AS SUM_TOKI_6MON_Y_KIN
       ,SUM(RECD.TOKI_6MON_B_KIN) AS SUM_TOKI_6MON_B_KIN
       ,SUM(RECD.TOKI_TOTAL_Y_KIN) AS SUM_TOKI_TOTAL_Y_KIN
       ,SUM(RECD.TOKI_TOTAL_B_KIN) AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
       ,NULL AS ADDR_CODE_PREF
       ,NULL AS ADDR_CODE_CITY
       ,NULL AS SHIKUCHOSON_MEI_KJ
       ,NULL AS ACTIVITY_TYPE
       ,NULL AS TARGET_SUMMARY
    FROM
        DPM_C_VI_INS_MST INS
        LEFT  JOIN DPM_C_INS_M_PLAN IMP  ON INS.INS_NO = IMP.INS_NO
               AND IMP.CAL_YEAR = #calYear:CHAR#
               AND IMP.CAL_TERM = #calTerm:CHAR#
               AND IMP.PROD_CODE = #prodCode:CHAR#
               AND IMP.DEL_FLG = '0'
        LEFT JOIN (<include refid="insTermPlan"/>) INS_TERM_PLAN
           ON INS_TERM_PLAN.INS_NO = IMP.INS_NO
              AND INS_TERM_PLAN.PROD_CODE = IMP.PROD_CODE
              AND INS_TERM_PLAN.CAL_YEAR = '$calYear$'
              AND INS_TERM_PLAN.CAL_TERM = '$calTerm.dbValue$'
        INNER JOIN DPM_C_VI_MR_INS MI
           ON IMP.INS_NO = MI.INS_NO
        INNER JOIN DPS_S_SY_T_JIS_MST JIS
           ON INS.ADDR_CODE_PREF = JIS.TODOUFUKEN_CD
              AND INS.ADDR_CODE_CITY = JIS.SHIKUCHOSON_CD
        INNER JOIN DPM_V_VI_ACTIVITY_TYPE AT
           ON IMP.INS_NO = AT.INS_NO
              AND IMP.CAL_YEAR = AT.CAL_YEAR
              AND IMP.CAL_TERM = AT.CAL_TERM
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
         LEFT JOIN INS_PROD_RECORD RECD
           ON RECD.INS_NO = INS.INS_NO
              AND RECD.PROD_CODE = #prodCode:CHAR#
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
     WHERE MI.MR_NO = #jgiNo:INTEGER#
           AND MI.MAIN_MR = '0'
       <isNotNull property="activityType" prepend="AND">
           AT.ACTIVITY_TYPE = #activityType:CHAR#
       </isNotNull>
  </select>

 <select id="selectListByIns" resultMap="resultMap" parameterClass="java.util.Map" >
  WITH INS_MONTH_PLAN AS (
    SELECT IMP.SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
          ,IMP.PROD_CODE
          ,IMP.INS_NO
          ,IMP.PLANNED_1_VALUE_YB
          ,IMP.PLANNED_2_VALUE_YB
          ,IMP.PLANNED_3_VALUE_YB
          ,IMP.PLANNED_4_VALUE_YB
          ,IMP.PLANNED_5_VALUE_YB
          ,IMP.PLANNED_6_VALUE_YB
          ,IMP.EXPECTED_1_VALUE_YB
          ,IMP.EXPECTED_2_VALUE_YB
          ,IMP.EXPECTED_3_VALUE_YB
          ,IMP.EXPECTED_4_VALUE_YB
          ,IMP.EXPECTED_5_VALUE_YB
          ,IMP.EXPECTED_6_VALUE_YB
          ,IMP.DEL_FLG
          ,IMP.IS_JGI_NO
          ,IMP.IS_JGI_NAME
          ,IMP.IS_DATE
          ,IMP.IS_PG_ID
          ,IMP.UP_JGI_NO
          ,IMP.UP_JGI_NAME
          ,IMP.UP_DATE
          ,IMP.UP_PG_ID
          ,INS.INS_ABBR_NAME
          ,INS.TRADE_TYPE
          ,INS.REQ_FLG
          ,INS.DEL_FLG AS INS_DEL_FLG
          ,INS.INS_CLASS
          ,INS.OLD_INSR_FLG
      FROM
          DPM_C_INS_M_PLAN IMP
          INNER JOIN DPM_C_VI_INS_MST INS ON IMP.INS_NO = INS.INS_NO
      WHERE
          IMP.CAL_YEAR = '$calYear$'
          AND IMP.CAL_TERM = '$calTerm.dbValue$'
          AND IMP.INS_NO = #insNo:VARCHAR#
          <isEqual property="tgtInsKb" compareValue="1">
          AND INS.HO_INS_TYPE != '4'
          </isEqual>
  )
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
  ,INS_PROD_RECORD AS (
    SELECT RCD.INS_NO INS_NO
          ,CPR.PROD_CODE PROD_CODE
          ,SUM(RCD.TOKI_1MON_Y_KIN) TOKI_1MON_Y_KIN
          ,SUM(RCD.TOKI_1MON_B_KIN) TOKI_1MON_B_KIN
          ,SUM(RCD.TOKI_2MON_Y_KIN) TOKI_2MON_Y_KIN
          ,SUM(RCD.TOKI_2MON_B_KIN) TOKI_2MON_B_KIN
          ,SUM(RCD.TOKI_3MON_Y_KIN) TOKI_3MON_Y_KIN
          ,SUM(RCD.TOKI_3MON_B_KIN) TOKI_3MON_B_KIN
          ,SUM(RCD.TOKI_4MON_Y_KIN) TOKI_4MON_Y_KIN
          ,SUM(RCD.TOKI_4MON_B_KIN) TOKI_4MON_B_KIN
          ,SUM(RCD.TOKI_5MON_Y_KIN) TOKI_5MON_Y_KIN
          ,SUM(RCD.TOKI_5MON_B_KIN) TOKI_5MON_B_KIN
          ,SUM(RCD.TOKI_6MON_Y_KIN) TOKI_6MON_Y_KIN
          ,SUM(RCD.TOKI_6MON_B_KIN) TOKI_6MON_B_KIN
          ,SUM(RCD.TOKI_TOTAL_Y_KIN) TOKI_TOTAL_Y_KIN
          ,SUM(RCD.TOKI_TOTAL_B_KIN) TOKI_TOTAL_B_KIN
      FROM
          DPS_S_SY_V_S_TK05_SST_TKY_Z6K RCD
      <!-- 4月、5月第3営業日まで、10月、11月第3営業日までは実績取得しない -->
      INNER JOIN
      (SELECT *
       FROM DPS_S_SY_COM_CAL T1
       WHERE T1.TODAY = '1'
       AND (
         T1.CAL_MONTH IN('01','02','03','06','07','08','09','12')
         OR (T1.CAL_MONTH IN('05','11') AND T1.CAL_DAY
             > (SELECT CAL_DAY FROM ORADPX01.DPS_S_SY_COM_CAL
                WHERE CAL_YEAR = T1.CAL_YEAR AND CAL_MONTH = T1.CAL_MONTH AND BIZ_DAYS='3')
            )
       )
      )CAL
      ON 1= 1
      INNER JOIN
      <!-- DPM_C_PLANNED_PROD、DPM_C_CPRODを参照する -->
      (
        SELECT
          PROD_CODE,
          STAT_PROD_CODE
        FROM DPM_C_PLANNED_PROD
        WHERE CAL_YEAR = '$calYear$'
        AND   CAL_TERM = '$calTerm.dbValue$'
        UNION
        SELECT
          PROD_CODE,
          ORG_STAT_PROD_CODE AS STAT_PROD_CODE
        FROM DPM_C_CPROD CCP
        WHERE CAL_YEAR = '$calYear$'
        AND   CAL_TERM = '$calTerm.dbValue$'
      )CPR
      ON CPR.STAT_PROD_CODE = RCD.TTL_TKYHM_K_5_CD
      WHERE RCD.IYK_WKT_KBN = #iykWktKbn:VARCHAR#
        AND RCD.INS_NO = #insNo:VARCHAR#
        <isNotNull property="nnuJhoSbt">
           <iterate prepend="AND RCD.NNU_JHO_SBT IN" open="(" close=")" conjunction=","  property="nnuJhoSbt">
               #nnuJhoSbt[]#
           </iterate>
        </isNotNull>
      GROUP BY
           RCD.INS_NO
          ,CPR.PROD_CODE
  )
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    SELECT IMP.SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
          ,PP.PROD_CODE
          ,#insNo:VARCHAR# AS INS_NO
          ,INS_TERM_PLAN.PLANNED_TERM_VALUE
          ,IMP.PLANNED_1_VALUE_YB
          ,IMP.PLANNED_2_VALUE_YB
          ,IMP.PLANNED_3_VALUE_YB
          ,IMP.PLANNED_4_VALUE_YB
          ,IMP.PLANNED_5_VALUE_YB
          ,IMP.PLANNED_6_VALUE_YB
          ,IMP.EXPECTED_1_VALUE_YB
          ,IMP.EXPECTED_2_VALUE_YB
          ,IMP.EXPECTED_3_VALUE_YB
          ,IMP.EXPECTED_4_VALUE_YB
          ,IMP.EXPECTED_5_VALUE_YB
          ,IMP.EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,RECD.TOKI_1MON_Y_KIN
          ,RECD.TOKI_1MON_B_KIN
          ,RECD.TOKI_2MON_Y_KIN
          ,RECD.TOKI_2MON_B_KIN
          ,RECD.TOKI_3MON_Y_KIN
          ,RECD.TOKI_3MON_B_KIN
          ,RECD.TOKI_4MON_Y_KIN
          ,RECD.TOKI_4MON_B_KIN
          ,RECD.TOKI_5MON_Y_KIN
          ,RECD.TOKI_5MON_B_KIN
          ,RECD.TOKI_6MON_Y_KIN
          ,RECD.TOKI_6MON_B_KIN
          ,RECD.TOKI_TOTAL_Y_KIN
          ,RECD.TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,IMP.DEL_FLG
          ,IMP.IS_JGI_NO
          ,IMP.IS_JGI_NAME
          ,IMP.IS_DATE
          ,IMP.IS_PG_ID
          ,IMP.UP_JGI_NO
          ,IMP.UP_JGI_NAME
          ,IMP.UP_DATE
          ,IMP.UP_PG_ID
          ,IMP.INS_ABBR_NAME
          ,PP.PROD_NAME
          ,IMP.TRADE_TYPE
          ,IMP.REQ_FLG
          ,IMP.INS_DEL_FLG
          ,IMP.INS_CLASS
          ,IMP.OLD_INSR_FLG
          ,MIP.MR_NO AS JGI_NO
          ,JM.JGI_NAME
          ,JM.SOS_CD2
          ,JM.SOS_CD3
          ,JM.ETC_SOS_FLG
          ,NULL AS SUM_PLANNED_TERM_VALUE
          ,NULL AS SUM_PLANNED_1_VALUE_YB
          ,NULL AS SUM_PLANNED_2_VALUE_YB
          ,NULL AS SUM_PLANNED_3_VALUE_YB
          ,NULL AS SUM_PLANNED_4_VALUE_YB
          ,NULL AS SUM_PLANNED_5_VALUE_YB
          ,NULL AS SUM_PLANNED_6_VALUE_YB
          ,NULL AS SUM_EXPECTED_1_VALUE_YB
          ,NULL AS SUM_EXPECTED_2_VALUE_YB
          ,NULL AS SUM_EXPECTED_3_VALUE_YB
          ,NULL AS SUM_EXPECTED_4_VALUE_YB
          ,NULL AS SUM_EXPECTED_5_VALUE_YB
          ,NULL AS SUM_EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS SUM_TOKI_1MON_Y_KIN
          ,NULL AS SUM_TOKI_1MON_B_KIN
          ,NULL AS SUM_TOKI_2MON_Y_KIN
          ,NULL AS SUM_TOKI_2MON_B_KIN
          ,NULL AS SUM_TOKI_3MON_Y_KIN
          ,NULL AS SUM_TOKI_3MON_B_KIN
          ,NULL AS SUM_TOKI_4MON_Y_KIN
          ,NULL AS SUM_TOKI_4MON_B_KIN
          ,NULL AS SUM_TOKI_5MON_Y_KIN
          ,NULL AS SUM_TOKI_5MON_B_KIN
          ,NULL AS SUM_TOKI_6MON_Y_KIN
          ,NULL AS SUM_TOKI_6MON_B_KIN
          ,NULL AS SUM_TOKI_TOTAL_Y_KIN
          ,NULL AS SUM_TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS ADDR_CODE_PREF
          ,NULL AS ADDR_CODE_CITY
          ,NULL AS SHIKUCHOSON_MEI_KJ
          ,NULL AS ACTIVITY_TYPE
          ,NVL2(CM.DATA_SEQ, CM.DATA_SEQ, 999) AS DATA_SEQ
          <!-- mod Start 2022/08/25 H.futagami No.8　計画管理の月別計画に納入実績の値を表示 -->
          <!-- ,NVL2(TARGET_SUMMARY.PROD_CODE, '1', '0') AS TARGET_SUMMARY -->
          ,'1' AS TARGET_SUMMARY
          <!-- mod end 2022/08/25 H.futagami No.8　計画管理の月別計画に納入実績の値を表示 -->
      FROM
          DPM_C_PLANNED_PROD PP
          LEFT JOIN DPM_C_CD_MST CM ON CM.DATA_KBN = 'sort_prod' AND PP.PROD_CODE = CM.DATA_CD
          INNER JOIN DPM_C_MR_INS_PROD MIP ON MIP.INS_NO = #insNo:VARCHAR# AND PP.PROD_CODE = MIP.PROD_CODE
          INNER JOIN DPM_C_VI_JGI_MST  JM  ON JM.JGI_NO  = MIP.MR_NO
          LEFT JOIN INS_MONTH_PLAN IMP
          ON IMP.PROD_CODE = PP.PROD_CODE
             AND IMP.CAL_YEAR = PP.CAL_YEAR
             AND IMP.CAL_TERM = PP.CAL_TERM
             AND IMP.INS_NO = #insNo:VARCHAR#
             AND IMP.DEL_FLG = '0'
          LEFT JOIN (<include refid="insTermPlan"/>) INS_TERM_PLAN
              ON INS_TERM_PLAN.INS_NO = #insNo:VARCHAR#
              AND INS_TERM_PLAN.PROD_CODE = PP.PROD_CODE
              AND INS_TERM_PLAN.CAL_YEAR = '$calYear$'
              AND INS_TERM_PLAN.CAL_TERM = '$calTerm.dbValue$'
          LEFT JOIN (<include refid="targetSummary"/>) TARGET_SUMMARY
          ON TARGET_SUMMARY.CAL_YEAR = '$calYear$'
             AND TARGET_SUMMARY.CAL_TERM = '$calTerm.dbValue$'
             AND TARGET_SUMMARY.PROD_CODE = PP.PROD_CODE
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          LEFT JOIN INS_PROD_RECORD RECD
              ON RECD.INS_NO = MIP.INS_NO
             AND RECD.PROD_CODE = MIP.PROD_CODE
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
      WHERE
          PP.PLAN_LEVEL_INS = '1'
          AND PP.CAL_YEAR = '$calYear$'
          AND PP.CAL_TERM = '$calTerm.dbValue$'
       <isNull property="jrnsCtgList">
          AND PP.SALES = #sales:CHAR#
       <isNotNull prepend="AND" property="category">
           PP.CATEGORY = #category:CHAR#
       </isNotNull>
       </isNull>
       <isNotNull property="jrnsCtgList">
       <iterate prepend=" AND PP.CATEGORY IN " open="(" close=")" conjunction=","  property="jrnsCtgList">
           #jrnsCtgList[]#
       </iterate>
       </isNotNull>
          <isPropertyAvailable property="sortString">
          $sortString$
          </isPropertyAvailable>
  </select>

 <select id="selectPlanSum" resultMap="resultMap" parameterClass="java.util.Map" >
  WITH INS_MONTH_PLAN AS (
    SELECT IMP.SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
          ,IMP.PROD_CODE
          ,IMP.INS_NO
          ,IMP.PLANNED_1_VALUE_YB
          ,IMP.PLANNED_2_VALUE_YB
          ,IMP.PLANNED_3_VALUE_YB
          ,IMP.PLANNED_4_VALUE_YB
          ,IMP.PLANNED_5_VALUE_YB
          ,IMP.PLANNED_6_VALUE_YB
          ,IMP.EXPECTED_1_VALUE_YB
          ,IMP.EXPECTED_2_VALUE_YB
          ,IMP.EXPECTED_3_VALUE_YB
          ,IMP.EXPECTED_4_VALUE_YB
          ,IMP.EXPECTED_5_VALUE_YB
          ,IMP.EXPECTED_6_VALUE_YB
          ,IMP.DEL_FLG
          ,IMP.IS_JGI_NO
          ,IMP.IS_JGI_NAME
          ,IMP.IS_DATE
          ,IMP.IS_PG_ID
          ,IMP.UP_JGI_NO
          ,IMP.UP_JGI_NAME
          ,IMP.UP_DATE
          ,IMP.UP_PG_ID
          ,INS.INS_ABBR_NAME
          ,INS.TRADE_TYPE
          ,INS.REQ_FLG
          ,INS.DEL_FLG AS INS_DEL_FLG
          ,INS.INS_CLASS
          ,INS.OLD_INSR_FLG
      FROM
          DPM_C_INS_M_PLAN IMP
          INNER JOIN DPM_C_VI_INS_MST INS ON IMP.INS_NO = INS.INS_NO
      WHERE
          IMP.CAL_YEAR = '$calYear$'
          AND IMP.CAL_TERM = '$calTerm.dbValue$'
          AND IMP.INS_NO = #insNo:VARCHAR#
          <isEqual property="tgtInsKb" compareValue="1">
          AND INS.HO_INS_TYPE != '4'
          </isEqual>
  )
 <!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
  ,INS_PROD_RECORD AS (
    SELECT RCD.INS_NO INS_NO
          ,CPR.PROD_CODE PROD_CODE
          ,SUM(RCD.TOKI_1MON_Y_KIN) TOKI_1MON_Y_KIN
          ,SUM(RCD.TOKI_1MON_B_KIN) TOKI_1MON_B_KIN
          ,SUM(RCD.TOKI_2MON_Y_KIN) TOKI_2MON_Y_KIN
          ,SUM(RCD.TOKI_2MON_B_KIN) TOKI_2MON_B_KIN
          ,SUM(RCD.TOKI_3MON_Y_KIN) TOKI_3MON_Y_KIN
          ,SUM(RCD.TOKI_3MON_B_KIN) TOKI_3MON_B_KIN
          ,SUM(RCD.TOKI_4MON_Y_KIN) TOKI_4MON_Y_KIN
          ,SUM(RCD.TOKI_4MON_B_KIN) TOKI_4MON_B_KIN
          ,SUM(RCD.TOKI_5MON_Y_KIN) TOKI_5MON_Y_KIN
          ,SUM(RCD.TOKI_5MON_B_KIN) TOKI_5MON_B_KIN
          ,SUM(RCD.TOKI_6MON_Y_KIN) TOKI_6MON_Y_KIN
          ,SUM(RCD.TOKI_6MON_B_KIN) TOKI_6MON_B_KIN
          ,SUM(RCD.TOKI_TOTAL_Y_KIN) TOKI_TOTAL_Y_KIN
          ,SUM(RCD.TOKI_TOTAL_B_KIN) TOKI_TOTAL_B_KIN
      FROM
          DPS_S_SY_V_S_TK05_SST_TKY_Z6K RCD
      <!-- 4月、5月第3営業日まで、10月、11月第3営業日までは実績取得しない -->
      INNER JOIN
      (SELECT *
       FROM DPS_S_SY_COM_CAL T1
       WHERE T1.TODAY = '1'
       AND (
         T1.CAL_MONTH IN('01','02','03','06','07','08','09','12')
         OR (T1.CAL_MONTH IN('05','11') AND T1.CAL_DAY
             > (SELECT CAL_DAY FROM ORADPX01.DPS_S_SY_COM_CAL
                WHERE CAL_YEAR = T1.CAL_YEAR AND CAL_MONTH = T1.CAL_MONTH AND BIZ_DAYS='3')
            )
       )
      )CAL
      ON 1= 1
      INNER JOIN
      <!-- DPM_C_PLANNED_PROD、DPM_C_CPRODを参照する -->
      (
        SELECT
          PROD_CODE,
          STAT_PROD_CODE
        FROM DPM_C_PLANNED_PROD
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
        UNION
        SELECT
          PROD_CODE,
          ORG_STAT_PROD_CODE AS STAT_PROD_CODE
        FROM DPM_C_CPROD CCP
        WHERE CAL_YEAR = #calYear:CHAR#
        AND   CAL_TERM = #calTerm:CHAR#
      )CPR
      ON CPR.STAT_PROD_CODE = RCD.TTL_TKYHM_K_5_CD
      WHERE RCD.IYK_WKT_KBN = #iykWktKbn:VARCHAR#
        AND RCD.INS_NO = #insNo:VARCHAR#
        <isNotNull property="nnuJhoSbt">
           <iterate prepend="AND RCD.NNU_JHO_SBT IN" open="(" close=")" conjunction=","  property="nnuJhoSbt">
               #nnuJhoSbt[]#
           </iterate>
        </isNotNull>
      GROUP BY
           RCD.INS_NO
          ,CPR.PROD_CODE
  )
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
    SELECT NULL AS SEQ_KEY
          ,IMP.CAL_YEAR
          ,IMP.CAL_TERM
          ,NULL AS PROD_CODE
          ,#insNo:VARCHAR# AS INS_NO
          ,SUM(INS_TERM_PLAN.PLANNED_TERM_VALUE) AS PLANNED_TERM_VALUE
          ,SUM(IMP.PLANNED_1_VALUE_YB) AS PLANNED_1_VALUE_YB
          ,SUM(IMP.PLANNED_2_VALUE_YB) AS PLANNED_2_VALUE_YB
          ,SUM(IMP.PLANNED_3_VALUE_YB) AS PLANNED_3_VALUE_YB
          ,SUM(IMP.PLANNED_4_VALUE_YB) AS PLANNED_4_VALUE_YB
          ,SUM(IMP.PLANNED_5_VALUE_YB) AS PLANNED_5_VALUE_YB
          ,SUM(IMP.PLANNED_6_VALUE_YB) AS PLANNED_6_VALUE_YB
          ,SUM(IMP.EXPECTED_1_VALUE_YB) AS EXPECTED_1_VALUE_YB
          ,SUM(IMP.EXPECTED_2_VALUE_YB) AS EXPECTED_2_VALUE_YB
          ,SUM(IMP.EXPECTED_3_VALUE_YB) AS EXPECTED_3_VALUE_YB
          ,SUM(IMP.EXPECTED_4_VALUE_YB) AS EXPECTED_4_VALUE_YB
          ,SUM(IMP.EXPECTED_5_VALUE_YB) AS EXPECTED_5_VALUE_YB
          ,SUM(IMP.EXPECTED_6_VALUE_YB) AS EXPECTED_6_VALUE_YB
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,SUM(RECD.TOKI_1MON_Y_KIN) AS TOKI_1MON_Y_KIN
          ,SUM(RECD.TOKI_1MON_B_KIN) AS TOKI_1MON_B_KIN
          ,SUM(RECD.TOKI_2MON_Y_KIN) AS TOKI_2MON_Y_KIN
          ,SUM(RECD.TOKI_2MON_B_KIN) AS TOKI_2MON_B_KIN
          ,SUM(RECD.TOKI_3MON_Y_KIN) AS TOKI_3MON_Y_KIN
          ,SUM(RECD.TOKI_3MON_B_KIN) AS TOKI_3MON_B_KIN
          ,SUM(RECD.TOKI_4MON_Y_KIN) AS TOKI_4MON_Y_KIN
          ,SUM(RECD.TOKI_4MON_B_KIN) AS TOKI_4MON_B_KIN
          ,SUM(RECD.TOKI_5MON_Y_KIN) AS TOKI_5MON_Y_KIN
          ,SUM(RECD.TOKI_5MON_B_KIN) AS TOKI_5MON_B_KIN
          ,SUM(RECD.TOKI_6MON_Y_KIN) AS TOKI_6MON_Y_KIN
          ,SUM(RECD.TOKI_6MON_B_KIN) AS TOKI_6MON_B_KIN
          ,SUM(RECD.TOKI_TOTAL_Y_KIN) AS TOKI_TOTAL_Y_KIN
          ,SUM(RECD.TOKI_TOTAL_B_KIN) AS TOKI_TOTAL_B_KIN
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          ,NULL AS DEL_FLG
          ,NULL AS IS_JGI_NO
          ,NULL AS IS_JGI_NAME
          ,NULL AS IS_DATE
          ,NULL AS IS_PG_ID
          ,NULL AS UP_JGI_NO
          ,NULL AS UP_JGI_NAME
          ,NULL AS UP_DATE
          ,NULL AS UP_PG_ID
          ,NULL AS INS_ABBR_NAME
          ,NULL AS PROD_NAME
          ,NULL AS TRADE_TYPE
          ,NULL AS REQ_FLG
          ,NULL AS INS_DEL_FLG
          ,NULL AS INS_CLASS
          ,NULL AS OLD_INSR_FLG
          ,NULL AS JGI_NO
          ,NULL AS JGI_NAME
          ,NULL AS SOS_CD2
          ,NULL AS SOS_CD3
          ,NULL AS ETC_SOS_FLG
          ,NULL AS SUM_PLANNED_TERM_VALUE
          ,NULL AS SUM_PLANNED_1_VALUE_YB
          ,NULL AS SUM_PLANNED_2_VALUE_YB
          ,NULL AS SUM_PLANNED_3_VALUE_YB
          ,NULL AS SUM_PLANNED_4_VALUE_YB
          ,NULL AS SUM_PLANNED_5_VALUE_YB
          ,NULL AS SUM_PLANNED_6_VALUE_YB
          ,NULL AS SUM_EXPECTED_1_VALUE_YB
          ,NULL AS SUM_EXPECTED_2_VALUE_YB
          ,NULL AS SUM_EXPECTED_3_VALUE_YB
          ,NULL AS SUM_EXPECTED_4_VALUE_YB
          ,NULL AS SUM_EXPECTED_5_VALUE_YB
          ,NULL AS SUM_EXPECTED_6_VALUE_YB
          ,NULL AS ADDR_CODE_PREF
          ,NULL AS ADDR_CODE_CITY
          ,NULL AS SHIKUCHOSON_MEI_KJ
          ,NULL AS ACTIVITY_TYPE
          ,NULL AS DATA_SEQ
          ,NULL AS TARGET_SUMMARY
      FROM
          DPM_C_PLANNED_PROD PP
          LEFT JOIN DPM_C_CD_MST CM ON CM.DATA_KBN = 'sort_prod' AND PP.PROD_CODE = CM.DATA_CD
          INNER JOIN DPM_C_MR_INS_PROD MIP ON MIP.INS_NO = #insNo:VARCHAR# AND PP.PROD_CODE = MIP.PROD_CODE
          INNER JOIN DPM_C_VI_JGI_MST  JM  ON JM.JGI_NO  = MIP.MR_NO
          INNER JOIN INS_MONTH_PLAN IMP
          ON IMP.PROD_CODE = PP.PROD_CODE
             AND IMP.CAL_YEAR = PP.CAL_YEAR
             AND IMP.CAL_TERM = PP.CAL_TERM
             AND IMP.INS_NO = #insNo:VARCHAR#
          LEFT JOIN (<include refid="insTermPlan"/>) INS_TERM_PLAN
              ON INS_TERM_PLAN.INS_NO = #insNo:VARCHAR#
              AND INS_TERM_PLAN.PROD_CODE = PP.PROD_CODE
              AND INS_TERM_PLAN.CAL_YEAR = '$calYear$'
              AND INS_TERM_PLAN.CAL_TERM = '$calTerm.dbValue$'
          INNER JOIN (<include refid="targetSummary"/>) TARGET_SUMMARY
              ON TARGET_SUMMARY.CAL_YEAR = '$calYear$'
              AND TARGET_SUMMARY.CAL_TERM = '$calTerm.dbValue$'
              AND TARGET_SUMMARY.PROD_CODE = IMP.PROD_CODE
              AND IMP.DEL_FLG = '0'
<!-- add Start 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
          LEFT JOIN INS_PROD_RECORD RECD
              ON RECD.INS_NO = #insNo:VARCHAR#
              AND RECD.PROD_CODE = PP.PROD_CODE
<!-- add End 2022/08/25 R.takamoto No.8　計画管理の月別計画に納入実績の値を表示 -->
      WHERE
          PP.PLAN_LEVEL_INS = '1'
          AND PP.SALES = #sales:CHAR#
          AND PP.CAL_YEAR = '$calYear$'
          AND PP.CAL_TERM = '$calTerm.dbValue$'
          <isNotNull property="category" prepend="AND">
          PP.CATEGORY = #category:CHAR#
          </isNotNull>
      GROUP BY IMP.CAL_YEAR, IMP.CAL_TERM
  </select>

  <insert id="insert" parameterClass="jp.co.takeda.model.ManageInsMonthPlan" >
    INSERT INTO DPM_C_INS_M_PLAN
          (SEQ_KEY
          ,CAL_YEAR
          ,CAL_TERM
          ,PROD_CODE
          ,INS_NO
          ,PLANNED_1_VALUE_YB
          ,PLANNED_2_VALUE_YB
          ,PLANNED_3_VALUE_YB
          ,PLANNED_4_VALUE_YB
          ,PLANNED_5_VALUE_YB
          ,PLANNED_6_VALUE_YB
          ,EXPECTED_1_VALUE_YB
          ,EXPECTED_2_VALUE_YB
          ,EXPECTED_3_VALUE_YB
          ,EXPECTED_4_VALUE_YB
          ,EXPECTED_5_VALUE_YB
          ,EXPECTED_6_VALUE_YB
          ,DEL_FLG
          ,IS_JGI_NO
          ,IS_JGI_NAME
          ,IS_DATE
          ,IS_PG_ID
          ,UP_JGI_NO
          ,UP_JGI_NAME
          ,UP_DATE
          ,UP_PG_ID)
    VALUES (ORADPX01.SEQ_DPM_C_INS_M_PLAN.NEXTVAL
          , #calYear:CHAR#
          , #calTerm:CHAR#
          , #prodCode:CHAR#
          , #insNo:VARCHAR#
          , #implMonthPlan.planned1ValueYb:BIGINT#
          , #implMonthPlan.planned2ValueYb:BIGINT#
          , #implMonthPlan.planned3ValueYb:BIGINT#
          , #implMonthPlan.planned4ValueYb:BIGINT#
          , #implMonthPlan.planned5ValueYb:BIGINT#
          , #implMonthPlan.planned6ValueYb:BIGINT#
          , #implMonthPlan.expected1ValueYb:BIGINT#
          , #implMonthPlan.expected2ValueYb:BIGINT#
          , #implMonthPlan.expected3ValueYb:BIGINT#
          , #implMonthPlan.expected4ValueYb:BIGINT#
          , #implMonthPlan.expected5ValueYb:BIGINT#
          , #implMonthPlan.expected6ValueYb:BIGINT#
          , #delFlg:CHAR#
          , #isJgiNo:INTEGER#
          , #isJgiName:VARCHAR#
          , SYSTIMESTAMP
          , #isPgId:VARCHAR#
          , #upJgiNo:INTEGER#
          , #upJgiName:VARCHAR#
          , SYSTIMESTAMP
          , #upPgId:VARCHAR#)
  </insert>

  <update id="update" parameterClass="jp.co.takeda.model.ManageInsMonthPlan" >
    UPDATE DPM_C_INS_M_PLAN
       SET DEL_FLG = #delFlg:CHAR#
          ,PLANNED_1_VALUE_YB = #implMonthPlan.planned1ValueYb:BIGINT#
          ,PLANNED_2_VALUE_YB = #implMonthPlan.planned2ValueYb:BIGINT#
          ,PLANNED_3_VALUE_YB = #implMonthPlan.planned3ValueYb:BIGINT#
          ,PLANNED_4_VALUE_YB = #implMonthPlan.planned4ValueYb:BIGINT#
          ,PLANNED_5_VALUE_YB = #implMonthPlan.planned5ValueYb:BIGINT#
          ,PLANNED_6_VALUE_YB = #implMonthPlan.planned6ValueYb:BIGINT#
          ,EXPECTED_1_VALUE_YB = #implMonthPlan.expected1ValueYb:BIGINT#
          ,EXPECTED_2_VALUE_YB = #implMonthPlan.expected2ValueYb:BIGINT#
          ,EXPECTED_3_VALUE_YB = #implMonthPlan.expected3ValueYb:BIGINT#
          ,EXPECTED_4_VALUE_YB = #implMonthPlan.expected4ValueYb:BIGINT#
          ,EXPECTED_5_VALUE_YB = #implMonthPlan.expected5ValueYb:BIGINT#
          ,EXPECTED_6_VALUE_YB = #implMonthPlan.expected6ValueYb:BIGINT#
          ,UP_JGI_NO = #upJgiNo:INTEGER#
          ,UP_JGI_NAME = #upJgiName:VARCHAR#
          ,UP_DATE = SYSTIMESTAMP
          ,UP_PG_ID = #upPgId:VARCHAR#
     WHERE SEQ_KEY = #seqKey:BIGINT#
       AND TO_CHAR(UP_DATE,'YYYY/MM/DD HH24:MI:SS.FF3') = TO_CHAR(#upDate:TIMESTAMP#,'YYYY/MM/DD HH24:MI:SS.FF3')
  </update>

</sqlMap>