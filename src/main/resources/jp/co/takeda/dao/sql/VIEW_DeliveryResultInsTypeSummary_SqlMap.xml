<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="VIEW_DeliveryResultInsTypeSummary_SqlMap" >

  <resultMap id="resultMapList" class="jp.co.takeda.model.view.DeliveryResultInsTypeSummary" >
    <result column="PROD_CODE" property="prodCode" jdbcType="CHAR" />
    <result column="INS_TYPE" property="insType" jdbcType="CHAR" />
    <result column="SUM_DELIVERY_RESULT" property="sumDeliveryRecord" jdbcType="BIGINT" />
  </resultMap>

  <!-- 試算対象品目 施設出力対象区分別、納入実績集計 -->
  <select id="searchSummaryList" resultMap="resultMapList" parameterClass="java.util.Map" >

        WITH KAKO_SUMMARY AS (
             SELECT
                DR.PROD_CODE,
                DR.INS_TYPE,
                SUM(DR.DELIVERY_RECORD_01) AS DELIVERY_RECORD_01,
                SUM(DR.DELIVERY_RECORD_02) AS DELIVERY_RECORD_02,
                SUM(DR.DELIVERY_RECORD_03) AS DELIVERY_RECORD_03,
                SUM(DR.DELIVERY_RECORD_04) AS DELIVERY_RECORD_04,
                SUM(DR.DELIVERY_RECORD_05) AS DELIVERY_RECORD_05,
                SUM(DR.DELIVERY_RECORD_06) AS DELIVERY_RECORD_06,
                SUM(DR.DELIVERY_RECORD_07) AS DELIVERY_RECORD_07,
                SUM(DR.DELIVERY_RECORD_08) AS DELIVERY_RECORD_08,
                SUM(DR.DELIVERY_RECORD_09) AS DELIVERY_RECORD_09,
                SUM(DR.DELIVERY_RECORD_10) AS DELIVERY_RECORD_10,
                SUM(DR.DELIVERY_RECORD_11) AS DELIVERY_RECORD_11,
                SUM(DR.DELIVERY_RECORD_12) AS DELIVERY_RECORD_12,
                SUM(DR.DELIVERY_RECORD_13) AS DELIVERY_RECORD_13,
                SUM(DR.DELIVERY_RECORD_14) AS DELIVERY_RECORD_14,
                SUM(DR.DELIVERY_RECORD_15) AS DELIVERY_RECORD_15,
                SUM(DR.DELIVERY_RECORD_16) AS DELIVERY_RECORD_16,
                SUM(DR.DELIVERY_RECORD_17) AS DELIVERY_RECORD_17,
                SUM(DR.DELIVERY_RECORD_18) AS DELIVERY_RECORD_18,
                SUM(DR.DELIVERY_RECORD_19) AS DELIVERY_RECORD_19,
                SUM(DR.DELIVERY_RECORD_20) AS DELIVERY_RECORD_20,
                SUM(DR.DELIVERY_RECORD_21) AS DELIVERY_RECORD_21,
                SUM(DR.DELIVERY_RECORD_22) AS DELIVERY_RECORD_22,
                SUM(DR.DELIVERY_RECORD_23) AS DELIVERY_RECORD_23,
                SUM(DR.DELIVERY_RECORD_24) AS DELIVERY_RECORD_24
            FROM (((DPS_I_DELIVERY_RESULT DR
                INNER JOIN DPS_C_JGI_MST JM ON DR.JGI_NO = JM.JGI_NO)
                INNER JOIN DPS_C_SOS_MST SM ON JM.SOS_CD = SM.SOS_CD)
                INNER JOIN DPS_C_INS_MST IM ON DR.INS_NO = IM.INS_NO)
            WHERE
                DR.PROD_CODE = #refProdCode:CHAR#
                AND JM.SOS_CD3 = #sosCd3:VARCHAR#
            GROUP BY
                DR.PROD_CODE,
                DR.INS_TYPE
        )

        , KAKO_TRANS AS (
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_01 AS DELIVERY_RECORD, '01' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_02 AS DELIVERY_RECORD, '02' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_03 AS DELIVERY_RECORD, '03' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_04 AS DELIVERY_RECORD, '04' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_05 AS DELIVERY_RECORD, '05' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_06 AS DELIVERY_RECORD, '06' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_07 AS DELIVERY_RECORD, '07' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_08 AS DELIVERY_RECORD, '08' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_09 AS DELIVERY_RECORD, '09' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_10 AS DELIVERY_RECORD, '10' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_11 AS DELIVERY_RECORD, '11' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_12 AS DELIVERY_RECORD, '12' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_13 AS DELIVERY_RECORD, '13' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_14 AS DELIVERY_RECORD, '14' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_15 AS DELIVERY_RECORD, '15' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_16 AS DELIVERY_RECORD, '16' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_17 AS DELIVERY_RECORD, '17' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_18 AS DELIVERY_RECORD, '18' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_19 AS DELIVERY_RECORD, '19' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_20 AS DELIVERY_RECORD, '20' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_21 AS DELIVERY_RECORD, '21' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_22 AS DELIVERY_RECORD, '22' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_23 AS DELIVERY_RECORD, '23' AS REF_PERIOD FROM KAKO_SUMMARY
            UNION
            SELECT PROD_CODE, INS_TYPE, DELIVERY_RECORD_24 AS DELIVERY_RECORD, '24' AS REF_PERIOD FROM KAKO_SUMMARY
        )

        SELECT
            KT.PROD_CODE,
            KT.INS_TYPE,
            SUM(KT.DELIVERY_RECORD) AS SUM_DELIVERY_RESULT
        FROM KAKO_TRANS KT
        WHERE
            REF_PERIOD BETWEEN #refFrom:CHAR# AND #refTo:CHAR#
        GROUP BY
            KT.PROD_CODE,
            KT.INS_TYPE
  </select>

</sqlMap>