##dpm400C00.vm (医)施設特約店別計画編集画面
#set($pageTitle = $text.get("dpm400C00","title"))
#set($bodyOnfocusMethod = "return dialogWin.checkModal()")
#set($GridObjName = "dpm400C00Grid")
#set($GridObjName2 = "dpm400C00Grid2")

## (医)検索結果
#set( $dataList = $form.getRequestData("DPM400C00_DATA_R"))
#set( $headerData = $form.getRequestData("DPM400C00_INPUT_DATA_R"))
## (ワ)検索結果
#set( $dataListVaccine = $form.getRequestData("DPM400C01_DATA_R"))
#set( $dataTotalVaccine = $form.getRequestData("DPM400C01_DATA_R_TOTAL"))

## 府県名
#set($shikuchosonMeiKj = "")
#if($!form.bean.shikuchosonMeiKj && $!form.bean.shikuchosonMeiKj != "")
    #set($shikuchosonMeiKj = $!form.bean.shikuchosonMeiKj)
#end
## 市区町村名
#set($fukenMeiKj = "")
#if($!form.bean.fukenMeiKj && $!form.bean.fukenMeiKj != "")
    #set($fukenMeiKj = $!form.bean.fukenMeiKj)
#end

## 計画
#set($planId = $form.bean.planId)

## 品目リスト
#set($vaccineCode = $service.getVaccineCode())
#if($form.bean.prodCategory == "$vaccineCode")
  #set($prodList = $service.getManageVaccineProdList($!form.bean.prodCategory, $form.getField("DPM400C00_PLANLEVEL_INS_WS"),false))
#else
  #set($prodList = $service.getManageIyakuProdList($!form.bean.prodCategory, $form.getField("DPM400C00_PLANLEVEL_INS_WS"),false))
#end

## 品目名
#set($prodName = "")
#if($form.bean.prodCode)
#foreach($codeAndValue in $prodList)
    #if($codeAndValue.code == $form.bean.prodCode)
        #set($prodName = "$codeAndValue.value")
    #end
#end
#end

## 対象区分リスト
## ワクチンの場合はリストを取得しない
#if($form.bean.prodCategory != "$vaccineCode")
## カテゴリから対象施設区分を取得
#set($insKbn = $service.getSelectInsKbnList($!form.bean.prodCategory).get(0).value)
## 雑なし
#if($insKbn == "1")
  #set ($insKbnList = $form.bean.insTypeList)
## 雑あり
#elseif($insKbn == "2")
  #set ($insKbnList = $form.bean.insTypeZList)
#end
#end

## 全MRフラグ
#set($mrflg = $!form.bean.mrFlg)

<script language="javascript">
<!--
document.getElementById("closeWindow").value = "true";
var startTime = new Date();
var ${GridObjName};
var ${GridObjName2};
var editFlg = false;
var inspos = 0;
var tmsWidth = 100;

## 【検索】組織選択ダイアログ後処理
function sosDialogAfter(sosCd, jgiNo, sosMaxSrchGetValue, etcSosFlg){
	let memorizer = new CategoryAndProdCodeMemorizer();

    sosApply(sosCd, jgiNo, sosMaxSrchGetValue, etcSosFlg);
    document.getElementById('insNo').value = '';
    dpm400C00InsClear();
    document.getElementById("insType").selectedIndex = 0;
    changeCategory();

    memorizer.undoCategoryCodeValue();
    changeProd();
    memorizer.undoProdCodeValue();

}

## カテゴリリストの変更処理
## 組織・担当を変更した時
function changeCategory() {

	var form = document.dpm400C00F05Form;

	## 選択した組織のカテゴリ
    var sosCategoryAry = document.getElementById('sosCategory').value.split(',');


    ## 組織コードの取得
    var sosCd;
    if(isEntered(form.sosCd4.value)){
      sosCd = form.sosCd4.value;
    } else if(isEntered(form.sosCd3.value)){
      sosCd = form.sosCd3.value;
    } else if(isEntered(form.sosCd2.value)){
      sosCd = form.sosCd2.value;
    } else {
      sosCd = null;
    }

    ## 計画対象カテゴリ領域より、立案レベルを条件にカテゴリを取得
    var planLvCtgList = [];

    planLvCtgList = [
                    #foreach($val in $service.getCategoryByPlanLevel($form.getField("DPM400C00_PLANLEVEL_INS_WS")))
                    , '$val'
                    #end
                    ];

	## 選択した組織のカテゴリは、このタイミングでvelocityで取得できないので、カテゴリを一旦全て取得
    var categoryList = [
                      #foreach($codeAndValue in $service.getDpmCategory(null, false, "$planId"))
                      , { text: '$codeAndValue.value', value: '$codeAndValue.code' }
                      #end
                     ];
    ## カテゴリのselectbox
	var prodCategory = document.getElementsByName('prodCategory')[0];
	## 一旦selectboxのoptionを削除
	while(prodCategory.lastChild)
	{
		prodCategory.removeChild(prodCategory.lastChild);
	}
	## optionを作成
	var option;
	document.createElement('option');

	## 条件区分 ワクチンのみ参照・編集可能 の場合は、カテゴリ「ワクチン」のみを表示する
	if($!security.isVaccineOnly("DPM40")) {
		for (var i = 1; i < categoryList.length; i++){
			if (categoryList[i].value == "$vaccineCode") {
				option = document.createElement('option');
				option.setAttribute('value', categoryList[i].value);
				option.innerHTML = categoryList[i].text;
	    		prodCategory.appendChild(option);
	    		break;
    		}
		}
	## 全社選択時
	} else if (!form.sosCd4.value && !form.sosCd3.value && !form.sosCd2.value) {
		for (var i = 1; i < categoryList.length; i++){
			if (planLvCtgList.includes(categoryList[i].value)) {
				option = document.createElement('option');
				option.setAttribute('value', categoryList[i].value);
				option.innerHTML = categoryList[i].text;
	    		prodCategory.appendChild(option);
    		}
		}
	## 全社以外の組織選択時
	} else {
		## 選択した組織のカテゴリのみ残す
	    for (var i = 1; i < categoryList.length; i++){
	    	for(var j = 0; j < sosCategoryAry.length; j++) {
	    		if (categoryList[i].value == sosCategoryAry[j] && planLvCtgList.includes(categoryList[i].value)) {
					option = document.createElement('option');
					option.setAttribute('value', categoryList[i].value);
					option.innerHTML = categoryList[i].text;
	    			prodCategory.appendChild(option);
	    		}
	    	}
	    }
	}
	## カテゴリ変更処理
	changeProd();
}

## 【検索】特約店選択ダイアログを開く
function openTytenSearchDialog(){
    ## var url = '${link.setAction("dpm912C00F00")}?tmsSelectMode=$tmsselect.getGrayAndEnableButtonMode()&tytenApplyFuncName=dpm400C00TytenSearchApply';
    var url = '$link.setAction("dpm912C00F00").addQueryData("tmsSelectMode","$tmsselect.getGrayAndEnableButtonMode()").addQueryData("tytenApplyFuncName", "dpm400C00TytenSearchApply")';
    openModalWindowW(url);
}

## 【検索】特約店選択ダイアログを開く（ワ）
function openTytenSearchDialogVac(){
## add Start 2022/6/27  Y.Taniguchi バックログNo.15　ワクチンの場合、選択した都道府県に紐づく“特約店（本店）”のみ表示
##    var url = '${link.setAction("dpm912C00F00")}?tmsSelectMode=$tmsselect.getGrayAndEnableButtonMode()&tytenApplyFuncName=dpm400C00TytenSearchApply';
    var addrCodePref = document.getElementById("addrCodePref").value;
    var url ='${link.setAction("dpm912C01F00")}?tmsSelectMode=$tmsselect.getGrayAndEnableButtonMode()&tytenApplyFuncName=dpm400C00TytenSearchApply&addrCodePref=' + addrCodePref;
## add End 2022/6/27  Y.Taniguchi バックログNo.15　ワクチンの場合、選択した都道府県に紐づく“特約店（本店）”のみ表示
    openModalWindowW(url);
}

## 【検索】特約店選択ダイアログ コールバック
function dpm400C00TytenSearchApply(tytenCd, tytenName){
    document.getElementById("tmsTytenCd").value = tytenCd;
    document.getElementById("tmsTytenCdPart").value = removeZeroBlankFromEnd(tytenCd);
    document.getElementById("tmsTytenName").value = tytenName;
    document.getElementById("tmsTytenNameLabel").innerHTML = "<label>" + tytenName + "</label>";
}

## 【検索】特約店選択ダイアログ 初期化
function dpm400C00TytenSearchClear(){
    document.getElementById("tmsTytenCd").value = "";
    document.getElementById("tmsTytenName").value = "";
    document.getElementById("tmsTytenNameLabel").innerHTML = "<label>　</label>";
}

## 【検索】市区町村選択画面呼出
function dpm913C00F00() {
    var func = "dpm400C00AddrApply";
## add Start 2022/6/21 Y.Taniguchi バックログNo.21　組織に紐づく都道府県をプルダウンに表示する
    var sosInitSosCodeValue = document.getElementById('sosCd3').value;
    var url ='$link.setAction('dpm913C00F00')' + '?fukenApplyFuncName=' + func + '&sosInitSosCodeValue=' + sosInitSosCodeValue;
## add End 2022/6/21 Y.Taniguchi バックログNo.21　組織に紐づく都道府県をプルダウンに表示する
    var args = new Array();
    openModalWindowW(url);
    dpm400C00InsClear();
    document.getElementById('tmsTytenCdPart').value = '';
    dpm400C00TytenSearchClear();
}

## 【検索】市区町村選択ダイアログ コールバック
function dpm400C00AddrApply(fukenCode,shikuCode,fukenName,shikuName){
    document.getElementById("addrCodePref").value = fukenCode;
    document.getElementById("addrCodeCity").value = shikuCode;
    document.getElementById("shikuchosonMeiKjLabel").innerHTML = "<label>" + fukenName + "　" + shikuName + "</label>";
    document.getElementById("fukenMeiKj").value = fukenName;
    document.getElementById("shikuchosonMeiKj").value = shikuName;
}

## 【検索】市区町村 初期化
function dpm400C00AddrClear(){
    document.getElementById("addrCodePref").value = "";
    document.getElementById("addrCodeCity").value = "";
    document.getElementById("shikuchosonMeiKjLabel").innerHTML = "<label>　</label>";
    document.getElementById("fukenMeiKj").value = "";
    document.getElementById("shikuchosonMeiKj").value = "";
}

## 【検索】品目カテゴリ選択処理
function changeProd() {
	changeProdCategoryList(document.dpm400C00F05Form);
    var category = document.getElementById("prodCategory").value;
    if (category == "$vaccineCode") {
        ## 重点先/一般先
        document.getElementById("activityType_tr").style.display=''
        ## 市区町村
        document.getElementById("addr_tr").style.display=''
        ## （ワ）ボタン
        document.getElementById("vaccine_button_td").style.display=''
        ## ボタン
        document.getElementById("no_vaccine_button_td").style.display='none'
        ## 対象区分
        document.getElementById("insType_tr").style.display='none'
        ## 計画
        document.getElementById("planData_tr").style.display='none'
        ## 組織選択ボタン
        document.getElementById("ins_select").style.display='none'
        ## 特約店選択ボタン
        document.getElementById("tyten_select").style.display='none'
        ## 組織選択ボタン
        document.getElementById("ins_select").style.display=''
        ## 特約店選択ボタン
        document.getElementById("v_tyten_select").style.display=''
    }
    ## ワクチン以外の場合
    else
    {
        ## 重点先/一般先
        document.getElementById("activityType_tr").style.display='none'
        ## 市区町村
        document.getElementById("addr_tr").style.display='none'
        ## （ワ）ボタン
        document.getElementById("vaccine_button_td").style.display='none'
        ## ボタン
        document.getElementById("no_vaccine_button_td").style.display=''
        ## 対象区分
        document.getElementById("insType_tr").style.display=''
        ## 計画
        document.getElementById("planData_tr").style.display=''
        ## 組織選択ボタン
        document.getElementById("v_ins_select").style.display='none'
        ## 特約店選択ボタン
        document.getElementById("v_tyten_select").style.display='none'
        ## 組織選択ボタン
        document.getElementById("ins_select").style.display=''
        ## 特約店選択ボタン
        document.getElementById("tyten_select").style.display=''
    }

    setProdCodePullDown(document.getElementById("prodCodeTran").value);
}
## prodLevelを指定する必要がある場合、VMマクロでJSコードを生成する
## 引数はFormで指定したフィールド名
#changeProdList("DPM400C00_PLANLEVEL_INS_WS")

## 対象区分リストの変更処理
## カテゴリを変更した時
function changeInsKbn() {
	## カテゴリと対象施設区分のリストを取得
	var tgtInsKbnList = [
                         {}
                         #foreach($codeAndValue in $service.getSelectInsKbnList(null))
                        ,{ kbn: '$codeAndValue.value', category: '$codeAndValue.code' }
                         #end
                        ];
	## 選択しているカテゴリを取得
	var category = document.getElementById("prodCategory").value;
	## 対象施設区分
	var tgtInsKbn = '1';
	## 選択したカテゴリの対象施設区分を取得(1つのみのはず)
	for (var i = 1; i < tgtInsKbnList.length; i++){
		if (tgtInsKbnList[i].category == category) {
			tgtInsKbn = tgtInsKbnList[i].kbn;
			break;
		}
	}

    ## 対象区分のselectbox
	var insType = document.getElementsByName('insType')[0];
	## 一旦selectboxのoptionを削除
	while(insType.lastChild)
	{
		insType.removeChild(insType.lastChild);
	}

	## 対象区分に設定するリストを取得
	var insTypeList = [];
	## 雑なし
	if (tgtInsKbn == '1'){
		insTypeList = [
                        {}
                        #foreach($codeAndValue in $form.bean.insTypeList)
                       ,{ code: '$codeAndValue.code', value: '$codeAndValue.value' }
                        #end
                      ];
    ## 雑あり
	} else if (tgtInsKbn == '2') {
		insTypeList = [
		                {}
                        #foreach($codeAndValue in $form.bean.insTypeZList)
                       ,{ code: '$codeAndValue.code', value: '$codeAndValue.value' }
                        #end
                      ];
	}

	## optionを作成
	var option;
	document.createElement('option');
    for (var i = 1; i < insTypeList.length; i++){
		option = document.createElement('option');
		option.setAttribute('value', insTypeList[i].code);
		option.innerHTML = insTypeList[i].value;
		insType.appendChild(option);
    }
}

## 【検索】施設選択画面呼出
function dpm911C00F00() {
    var func = "dpm400C00InsApply";
    var insPtn = "01";
    var ptn = "01";
    var min = "02";
    var max = "04";
    var sosInitSosCodeValue = document.getElementById('sosCd4').value;
    var prodCode = document.getElementById("prodCode").value;
    ##全MR担当は、担当者まで表示
    if ($mrflg) {
        var jgiNo = '';
        jgiNo = "$!form.bean.jgiNo";
    	var url ='$link.setAction('dpm911C00F00')' + '?insApplyFuncName=' + func + '&insSelectPtnType=' + insPtn + '&sosSrchPtnType=' + ptn + '&sosMinSrchValue=' + min + '&sosMaxSrchGetValue=' + max + '&paramInsType=&sosInitSosCodeValue=&paramJgiNo=' + jgiNo + '&sosSearchNonFlg=false&paramJtnFlg=false&disableMallInsSelect=true' + '&prodCode=' + prodCode ;
    }else{
	    var jgiNo = document.getElementById('jgiNo').value;
	    var url ='$link.setAction('dpm911C00F00')' + '?insApplyFuncName=' + func + '&insSelectPtnType=' + insPtn + '&sosSrchPtnType=' + ptn + '&sosMinSrchValue=' + min + '&sosMaxSrchGetValue=' + max + '&sosSearchNonFlg=false&paramJtnFlg=false&sosInitSosCodeValue=&paramJgiNo=' + jgiNo  + '&prodCode=' + prodCode ;
    }
    var args = new Array();
    openModalWindowW(url, func, args);
}

## 【検索】施設選択ダイアログ コールバック
function dpm400C00InsApply(insNo, jgiNo, insName){
    document.getElementById("insNo").value = insNo;
    document.getElementById("insNameLabel").innerHTML = "<label>" + insName + "</label>";
    ##sosApply("", jgiNo, "04");
    var url ="$link.setAction('dpm911C00F10?sFlg=true')" + "&insNo=" + insNo;
    var insResult = getPage(url);
    var insResultArray = insResult.split(",");
    var insType = insResultArray[2];
    if(insType == "P"){
            document.getElementById("insType").selectedIndex = 1;
    }else{
            document.getElementById("insType").selectedIndex = 0;
    }
}

## 【検索】施設選択ダイアログ コールバック（ワ）
function dpm400C00InsApplyVac(insNo, jgiNo, insName){
        args = insNo;
        var insApplyFlg = true;
        text = getDataInsApplyVac(args, jgiNo);
        if(text != ""){
            var resultArray = text.split(",");
            var addrName = resultArray[0];
            var addr1 = resultArray[1];
            var addr2 = resultArray[2];
            var addrCode = addr1 + addr2;
            ##重複チェック
            ${GridObjName}.forEachRow(function(id){
                if((${GridObjName}.getUserData(id,"addrCode")) == addrCode && (${GridObjName}.cells(id,2).getValue()) == args && insApplyFlg){
                    insApplyFlg  = false;
                }
            });
            if(insApplyFlg){
                var rowNums = ${GridObjName}.getRowsNum();
                var insApplyInd = 0;
                var insApplyId = 0;
                var insApplyFlg2 = false;
                for (rowInd = 0; rowInd < ${GridObjName}.getRowsNum(); rowInd++) {
                    var id = ${GridObjName}.getRowId(rowInd);
                    if((${GridObjName}.getUserData(id,"addrCode")) == addrCode && !(insApplyFlg2)){
                        insApplyInd = rowInd;
                        insApplyId = id;
                        insApplyFlg2 = true;
                    }
                }
                ##rowType
                var rowType = "input";
                ##subTotalId
                if(!insApplyFlg2){
                    var subTotalId = ${GridObjName}.getUserData(rowNums,"subTotalId") - 0 + 1;
                }else{
                    var subTotalId = ${GridObjName}.getUserData(insApplyId ,"subTotalId") - 0;
                }
                ##ty変換率
                var tyChangeRate = "$!dataTotal.getTbChangeRate()";
                ##更新用ユーザデータ
                var rowIdListArray = new Array();
                rowIdListArray[0] = insNo;
                rowIdListArray[1] = null;
                rowIdListArray[2] = "$!form.bean.prodCode";
                rowIdListArray[3] = null;
                rowIdListArray[4] = null;
                rowIdListArray[5] = null;
                var rowIdList = rowIdListArray.join(",");
                ##特約店追加ボタン
                if(${GridObjName}.getUserData("","srowids")){
                    var srowids = ${GridObjName}.getUserData("","srowids").split(",");
                }else{
                    var srowids = new Array();
                    srowids.push("");
                }
                #if($form.bean.prodCategory == "$vaccineCode")
                var tytenAddBtn = "<input type='button' value='追加' onClick='inspos = " + srowids.length + ";openModalWindowW(\"${link.setAction('dpm912C00F00')}?tytenApplyFuncName=dpm400C01TytenApply\")' />"
                #else
                var tytenAddBtn = "<input type='button' value='追加' onClick='inspos = " + srowids.length + ";openModalWindowW(\"${link.setAction('dpm912C00F00')}?tytenApplyFuncName=dpm400C00TytenApply\")' />"
                #end
                var newid = rowNums + 1;
                ${GridObjName}.addRow(newid, addrName + "," + insName + "," + insNo + ",,," + tytenAddBtn, insApplyInd);
                ${GridObjName}.setUserData(newid, "insName", insName);
                ${GridObjName}.setUserData(newid, "rowType", rowType);
                ${GridObjName}.setUserData(newid, "subTotalId", subTotalId);
                ${GridObjName}.setUserData(newid, "tyChangeRate", tyChangeRate);
                ${GridObjName}.setUserData(newid, "rowIdList", rowIdList);
                ${GridObjName}.setUserData(newid, "addrCode", addrCode);
                ${GridObjName}.setUserData(newid, "ShikuchosonMeiKj", addrName);
                ${GridObjName}.setCellExcellType(newid, 8, "ed");
                ##施設計追加
                ${GridObjName}.addRow(newid + 1,",,,施設合計,",insApplyInd + 1);
                srowids.push(newid + 1);
                ${GridObjName}.setUserData("", "srowids", srowids.join(","));
                ${GridObjName}.setUserData(newid + 1, "srange", "," + newid);
                ${GridObjName}.setUserData(newid + 1, "checkCdList", "");
                ${GridObjName}.setUserData(newid + 1, "tyChangeRate", tyChangeRate);

                ${GridObjName}.setCellExcellType(newid + 1, 8, "ron");
                ${GridObjName}.setCellTextStyle(newid + 1, 0, "border-width: 1px 1px 0px 1px;");
                ${GridObjName}.setCellTextStyle(newid, 1, "border-width: 1px 1px 0px 1px;");
                ${GridObjName}.setCellTextStyle(newid, 2, "border-width: 1px 1px 0px 1px;");
                ${GridObjName}.setCellTextStyle(newid + 1, 3, "border-width: 1px 0px 1px 1px;");
                ${GridObjName}.setCellTextStyle(newid + 1, 4, "border-width: 1px 0px 1px 0px;");
                ${GridObjName}.setCellTextStyle(newid + 1, 5, "border-width: 1px 1px 1px 0px;");

                ##新規市区町村施設の場合、市区町村計追加
                if(!insApplyFlg2){
                    ##rowType
                    var _rowType = "subTotal";
                    ##subTotalId
                    var _subTotalId = subTotalId;
                    ##ty変換率
                    var _tyChangeRate = "$!dataTotal.getTbChangeRate()";
                    ${GridObjName}.addRow(newid + 2,",市区町村計,",insApplyInd + 2);
                    ${GridObjName}.setUserData(newid + 2, "rowType", _rowType);
                    ${GridObjName}.setUserData(newid + 2, "subTotalId", _subTotalId);
                    ${GridObjName}.setUserData(newid + 2, "tyChangeRate", _tyChangeRate);
                    ##施設計を計算範囲に追加
                    if(${GridObjName}.getUserData("","arowids")){
                        var arowids = ${GridObjName}.getUserData("","arowids").split(",");
                    }else{
                        var arowids = new Array();
                        arowids.push("");
                    }
                    arowids.push(newid + 2);
                    ${GridObjName}.setUserData("", "arowids", arowids.join(","));
                    ${GridObjName}.setUserData(newid + 2, "arange", "," + (newid + 1));
                    ${GridObjName}.setCellExcellType(newid + 2, 8, "ron");
                    ${GridObjName}.setCellTextStyle(newid + 2, 1, "border-width: 1px 0px 1px 1px;");
                    ${GridObjName}.setCellTextStyle(newid + 2, 2, "border-width: 1px 0px 1px 0px;");
                    ${GridObjName}.setCellTextStyle(newid + 2, 3, "border-width: 1px 0px 1px 0px;");
                    ${GridObjName}.setCellTextStyle(newid + 2, 4, "border-width: 1px 0px 1px 0px;");
                    ${GridObjName}.setCellTextStyle(newid + 2, 5, "border-width: 1px 1px 1px 0px;");
                }else{
                    ##施設計を計算範囲に追加
                    var aid = getSubTotalIdDown(${GridObjName},newid);
                    var arange = ${GridObjName}.getUserData(aid,"arange").split(",");
                    arange.push(newid + 1);
                    ${GridObjName}.setUserData(aid, "arange", arange.join(","));
                }
                ${GridObjName}.cells2(insApplyInd + 1, 0).setValue("");
                ${GridObjName}.cells2(insApplyInd + 2, 0).setValue("");
                ${GridObjName}.setCellExcellType(newid, 8, "ron");
                ${GridObjName}.setCellTextStyle(newid, 0, "border-width: 1px 1px 0px 1px;");
                ${GridObjName}.setCellTextStyle(newid, 5, "border-width: 1px 1px 0px 1px;");
            }else{
            	return "すでに入力欄が存在します";
            }
        }

}

##施設データ取得
function getDataInsApplyVac(insNo,jgiNo) {
    var url ="$link.setAction('dpm911C00F10?sFlg=true')" + "&insNo=" + insNo + "&jgiNo=" + jgiNo;
    var text = getPage(url);
    var resultArray = text.split(",");
    if(resultArray[6] == undefined){
        alert("施設情報を取得できません");
        result = "";
    }else{
        var result = resultArray[5] + ',' + resultArray[6] + ',' + resultArray[7];
    }
    return result;
}

## 【検索】施設 初期化
function dpm400C00InsClear(){
	## 施設名
    document.getElementById("insNameLabel").innerHTML = "<label>　</label>";
    document.getElementById('insName').value = "";
    ## 施設コード
    ##document.getElementById('insNo').value = "";
}

##特約店追加（ワ）
function dpm400C00TytenApplyVac(TytenCd,TytenName) {
    var args = TytenCd.split(",");
    var args2 = TytenName.split(",");
    if(!(args == "")) {
        var bid = inspos;
        var srowids = ${GridObjName}.getUserData("","srowids").split(",");
        var srowid = srowids[inspos];
        var srangeid = ${GridObjName}.getUserData(srowid,"srange").split(",");
        var checkCdList = ${GridObjName}.getUserData(srowid,"checkCdList").split(",");
        var insposid = srangeid[srangeid.length-1];
        var insposindex = ${GridObjName}.getRowIndex(insposid);
        inspos = insposindex + 1;
        var newids = "";
        ${GridObjName}.addRow(9999,"",(inspos));
        for(i=0; i<args.length; i++){
            for(j=0;j<checkCdList.length;j++){
                if(args[i] == checkCdList[j]){
                    ${GridObjName}.deleteRow(9999);
                    inspos = bid;
                    return "登録済み、または追加済みです";
                }
            }
            newid = ${GridObjName}.getRowsNum();
            if(arguments != 'undefined' &&  arguments != null && arguments.length == 3 && arguments[2]) {
                if (arguments[2] == 'true') {
                    ${GridObjName}.setUserData(newid,"planTaiGaiFlgTok",arguments[2]);
                    args2[i] = '$tmsselect.getPlanTaiGaiLabel()' + args2[i];
                }
            }
            text = getData(args[i],args2[i]);
            var upId = ${GridObjName}.getRowId(inspos - 1);
            var addFlg = false;
            ##//上の行の特約店名が空白なら施設名、ボタンをtextに追加して空白行削除
            if(${GridObjName}.cells(upId,3).getValue() == ""){
                text = ${GridObjName}.cells(upId,0).getValue() + "," + ${GridObjName}.cells(upId,1).getValue()+ "," + ${GridObjName}.cells(upId,2).getValue() + "," + text +  "," + ${GridObjName}.cells(upId,5).getValue();
                var _insName = ${GridObjName}.getUserData(upId,"insName");
                var _rowIdListArray = ${GridObjName}.getUserData(upId,"rowIdList").split(",");
                _rowIdListArray[1] = args[i];
                _rowIdListArray[3] = null;
                _rowIdListArray[4] = null;
                _rowIdListArray[5] = null;
                ${GridObjName}.deleteRow(upId);
                newid = upId;
                upId = upId - 1;
                inspos = inspos -1;;
                ${GridObjName}.setUserData(newid,"insName",_insName);
                ${GridObjName}.setUserData(newid,"rowIdList",_rowIdListArray.join(","));
                addFlg = true;
            }else{
                text = ",,," + text;
            }
            ${GridObjName}.addRow(newid,text,(inspos + i));
            setStyle(newid,upId,addFlg);
            newids = newids + "," + newid;
            ${GridObjName}.deleteRow(9999);
            if(!addFlg){
                ${GridObjName}.setUserData(newid,"insName",${GridObjName}.getUserData(upId,"insName"));
                var rowIdListArray = ${GridObjName}.getUserData(upId,"rowIdList").split(",");
                rowIdListArray[1] = args[i];
                rowIdListArray[3] = null;
                rowIdListArray[4] = null;
                rowIdListArray[5] = null;
                ${GridObjName}.setUserData(newid,"rowIdList",rowIdListArray.join(","));
                ${GridObjName}.setUserData(srowid,"srange",(srangeid + newids));
            }else{
                ${GridObjName}.setUserData(srowid,"srange",(newids));
            }
            ${GridObjName}.setUserData(srowid,"checkCdList",(checkCdList + "," + args[i]));
            ${GridObjName}.setUserData(newid,"bid",bid);
            ${GridObjName}.setUserData(newid,"rowType","input");
            ${GridObjName}.setUserData(newid,"subTotalId",bid);
            ${GridObjName}.setUserData(newid,"tmsTytenName",args2[i]);
            ${GridObjName}.setUserData(newid,"tmsTytenCd",args[i]);
            ${GridObjName}.setUserData(newid,"sumRowFlg","false");
            ${GridObjName}.setUserData(newid,"tyChangeRate","$!dataTotal.getTbChangeRate()");
            intCheck(${GridObjName},newid,8,"");

            ## 登録ボタン有効化
            var registBtn = document.getElementById('regist');
            if(registBtn.disabled == true){
                registBtn.disabled = false;
            }
        }
    }
}


## 検索処理
function dpm400C00F05() {
	var category = document.getElementById("prodCategory").value;
    ##ワクチンの場合
    if (category == "$vaccineCode") {
		if (!searchValidationForVac()) {
	    	return;
		}
	} else {
		if (!searchValidation()) {
	    	return;
		}
	}
	if(linkClick()){
		var category = document.getElementById("prodCategory").value;
	    ##ワクチンの場合
	    if(category == "$vaccineCode"){
	    	var actionPath = "$link.setAction('dpm400C00F25')";
            document.dpm400C00F05Form.action = actionPath;
            document.dpm400C00F05Form.submit();
            dpm400C00F05 = blockIt;
            dpm400C00F10 = blockIt;
        ##ワクチン以外の場合
	    }else{
        	var actionPath = "$link.setAction('dpm400C00F05')";
            document.dpm400C00F05Form.action = actionPath;
            document.dpm400C00F05Form.submit();
            dpm400C00F05 = blockIt;
            dpm400C00F10 = blockIt;
	    }
	}
}

## 検索時入力チェック
function searchValidation() {
    ## 入力フォーム
    var form = document.dpm400C00F05Form;
    var value = "";
    var existError = false;
    ## [必須] 組織・担当者
    var value1 = form.sosCd2.value;
    var value2 = form.insNo.value;
    errorMsg = '$text.get("DPC1006E",["組織または施設コード"])';
    existError = addErrorInfo(!(isEntered(value1) || isEntered(value2)), errorMsg);

    if(!existError){
        ## 施設コードが入力されている場合
        if(isEntered(form.insNo.value)){
            ## [数値] 施設コード
            value = form.insNo.value;
            errorMsg = '$text.get("DPC1004E",["施設コード","半角数字"])';
            existError = addErrorInfo(!(isNumber(value)), errorMsg);
        }else{
            ## 施設コードが入力されていない場合
            var index = form.insType.selectedIndex;
            if(form.insType.options[index].text == "UH"){
                value = form.sosCd3.value;
                errorMsg = '$text.get("DPC1025E",["組織・担当者","エリア","担当者"])';
                existError = addErrorInfo(!isEntered(value), errorMsg);
            }else{
                value = form.jgiNo.value;
                errorMsg = '$text.get("DPC1024E",["組織・担当者","担当者"])';
                existError = addErrorInfo(!isEntered(value), errorMsg);
            }
        }
        if(isEntered(form.tmsTytenCdPart.value)){
            ## [数値] 特約店コード
            value = form.tmsTytenCd.value;
            value2 = form.tmsTytenCdPart.value;
            errorMsg = '$text.get("DPC1004E",["特約店コード","半角数字"])';
            existError = addErrorInfo(!(isNumber(value) || isNumber(value2)), errorMsg);
            ## [桁数] 入力特約店コード
            if(!existError){
                value = form.tmsTytenCdPart.value;
                errorMsg = '$text.get("DPC1027E",["特約店コード","3,5,7,9,11,13"])';
                existError = addErrorInfo(!isTmsTytenCdLength(value), errorMsg);
            }
        }
    }
    ## [必須] カテゴリ
    value = form.prodCategory.value;
    errorMsg = '$text.get("DPC1003E",["カテゴリ"])';
    addErrorInfo(!isEntered(value), errorMsg);
    ## [必須] 品目
    value = form.prodCode.value;
    errorMsg = '$text.get("DPC1003E",["品目"])';
    addErrorInfo(!isEntered(value), errorMsg);
    ## [必須] 計画
    value = form.planData.value;
    errorMsg = '$text.get("DPC1003E",["計画"])';
    addErrorInfo(!isEntered(value), errorMsg);

    return validation();
}

## 検索時入力チェック(ワクチン)
function searchValidationForVac() {
    ## 入力フォーム
    var form = document.dpm400C00F05Form;

    var errorMsg = "";
    var isAdded = false;

    ## 従業員番号
    var jgiNo = form.jgiNo.value;

    ## 施設コード
    var insNo = form.insNo.value;

    ## [必須]担当者または施設コード
    if(!isAdded){
        if(insNo == "" && jgiNo == "" && form.sosCd3.value == "") {
            errorMsg = '$text.get("DPC1006E",["担当者または施設コード"])';
            isAdded = addErrorInfo(!isEntered(""), errorMsg)
        }
    }
    if(insNo != "") {
        ## [数値]施設コード
        if(!isAdded){
            errorMsg = '$text.get("DPC1004E",["施設コード","半角数字"])';
            isAdded = addErrorInfo(!isNumber(insNo), errorMsg)
        }
    }else{

        var index = form.activityType.selectedIndex;
        if(form.activityType.options[index].text == "一般先"){
            ## [必須]一般先が選択されている、かつ、担当者までが選択されていない
            value = form.jgiNo.value;
            errorMsg = '$text.get("DPC1024E",["組織・担当者","担当者"])';
            existError = addErrorInfo(!(isEntered(value)), errorMsg);
            ## [必須]一般先が選択されている、かつ、市区町村、特約店コードのいずれも選択されていない
            value = form.addrCodePref.value;
            value2 = form.addrCodeCity.value;
            value3 = form.tmsTytenCdPart.value;
            errorMsg = '$text.get("DPC1006E",["市区町村または特約店コード"])';
            var addrCodeCheck = isEntered(value) && isEntered(value2);
            var TytenCodeCheck = isEntered(value3);
            existError = addErrorInfo(!(addrCodeCheck || TytenCodeCheck), errorMsg);
        }else{
            ## [必須]重点先が選択されている、かつ、エリア特約店Gまでが選択されていない
            value = form.sosCd3.value;
            errorMsg = '$text.get("DPC1025E",["組織・担当者","エリア特約店Ｇ","担当者"])';
            existError = addErrorInfo(!(isEntered(value)), errorMsg);
        }
    }
    if(form.tmsTytenCdPart.value != "") {
        ## [数値]特約店コード
        if(!isAdded){
            errorMsg = '$text.get("DPC1004E",["特約店コード","半角数字"])';
            isAdded = addErrorInfo(!isNumber(form.tmsTytenCdPart.value), errorMsg)
        }
        ## [桁数] 入力特約店コード
        if(!isAdded){
            value = form.tmsTytenCdPart.value;
            errorMsg = '$text.get("DPC1027E",["特約店コード","3,5,7,9,11,13"])';
            isAdded = addErrorInfo(!isTmsTytenCdLength(value), errorMsg);
        }
    }
    ## [必須] 重点先/一般先
    value = form.activityType.value;
    errorMsg = '$text.get("DPC1003E",["重点先/一般先"])';
    addErrorInfo(!isEntered(value), errorMsg);
    ## [必須] 品目
    value = form.prodCode.value;
    errorMsg = '$text.get("DPC1003E",["品目"])';
    addErrorInfo(!isEntered(value), errorMsg);
    return validation();
}

##登録処理
function dpm400C00F10() {

    ## --- 編集中セル値の登録時チェック ---
	if(window.editValueChecker.isValid() == false){
		return;
	}

	##入力チェック
    if (!executeValidation()) {
        return;
    }
    ##確認
    if (!confirm('$text.get("DPM400C00.001","dialogue")')) {
        return;
    }
    form = document.dpm400C00F10Form;
    rowNum = ${GridObjName}.getRowsNum();
    try{
    for ( var i = 0; i < rowNum; i++) {
        ##//i番目の列のrowIdを取得
        var rowId = ${GridObjName}.getRowId(i);
        ##//指定項目のみ取得し、hiddenをformに追加
        ##//集計行じゃない場合
        if(${GridObjName}.getUserData(rowId, "rowType") == "input"){
            var value = ${GridObjName}.cells(rowId, 7).getValue();
            var rowIdList = ${GridObjName}.getUserData(rowId, "rowIdList");
            var planTaiGaiFlgTok = ${GridObjName}.getUserData(rowId, "planTaiGaiFlgTok");
            if (planTaiGaiFlgTok != 'undefined' && planTaiGaiFlgTok != null && planTaiGaiFlgTok != '' && planTaiGaiFlgTok == 'true') {
                if (value != 'undefined' && value != null && value != '') {
                    alert('$text.get("DPM999C00.001","dialogue")');
                    return;
                }
            }
            var sendvalue = rowIdList + "," + value;
            var element = document.createElement('input');
            element.type = "hidden";
            element.name = "rowIdList";
            element.value = sendvalue;
            form.appendChild(element);
        }
    }
    }catch(e){
        alert(rowId);
    }
    form.target = "self";
    form.submit();
    dpm400C00F05 = blockIt;
    dpm400C00F10 = blockIt;
}
## 更新時入力チェック
function executeValidation() {
    var rowNum = ${GridObjName}.getRowsNum();
    for (i = 0; i <= rowNum; i++) {
        var id = ${GridObjName}.getRowId(i);
        ## メッセージ準備
        var rowInfo = "";
        rowInfo = ${GridObjName}.getUserData(id,"insName") + "【" + ${GridObjName}.getUserData(id,"tmsTytenName") + "】";
        ## エラーチェック
        if(${GridObjName}.getUserData(id,"rowType") == "input"){
        	## [T価ベース]
            var checkValue = ${GridObjName}.cells(id, 7).getValue().toString();
            amountValidationNotTailCheck("", checkValue, 10, true, rowInfo);
        	## [Y価ベース]
            var tyChangeRate = ${GridObjName}.getUserData(id,"tyChangeRate");
            var checkValue = getYBaseValue(checkValue, tyChangeRate);
            amountValidationNotTailCheckNotInputNotDisp(rowInfo, checkValue, 10, true, "");
        }
    }
    return validation();
}

##リンク移動確認
function linkClick(){
    if(editFlg){
        var answer = window.confirm('$text.get("DPC999C99.001","dialogue")');
        if(!answer){
            return false;
        }
    }
    return true;
}

## （ワ）更新時入力チェック
function executeValidationForVac() {
    var rowNum = ${GridObjName}.getRowsNum();
    for (i = 0; i < rowNum; i++) {
        var id = ${GridObjName}.getRowId(i);
        ## メッセージ準備
        var rowInfo = "";
        rowInfo = ${GridObjName}.getUserData(id,"insName") + "【" + ${GridObjName}.getUserData(id,"tmsTytenName") + "】";
        ## エラーチェック
        if(${GridObjName}.getUserData(id,"rowType") == "input"){
        	## [T価ベース]
            var checkValue = ${GridObjName}.cells(id, 8).getValue().toString();
            amountValidationNotTailCheck("", checkValue, 10, true, rowInfo);
        	## [B価ベース]
            var tyChangeRate = ${GridObjName}.getUserData(id,"tyChangeRate");
            var checkValue = getYBaseValue(checkValue, tyChangeRate);
            amountValidationNotTailCheckNotInputNotDisp(rowInfo, checkValue, 10, true, "B価");
        }
    }
    return validation();
}

## 更新処理（ワ）
function dpm400C00F20Excecute() {

    ## --- 編集中セル値の登録時チェック ---
	if(window.editValueChecker.isValid() == false){
		return;
	}

    ##入力チェック
    if (!executeValidationForVac()) {
        return;
    }
    ##確認
    if (!confirm('$text.get("DPM400C01.001","dialogue")')) {
        return;
    }
    //rowIdList→rowIdList
    var form = document.dpm400C00F05Form;
    ## ユーザデータに編集後の計画値を追加
    var rowNum = ${GridObjName}.getRowsNum();
    for (i = 0; i < rowNum; i++) {
        ##//i番目の列のrowIdを取得
        var rowId = ${GridObjName}.getRowId(i);
        ##//指定項目のみ取得し、hiddenをformに追加
        ##//集計行じゃないかつ特約店が追加済み場合
        if(${GridObjName}.getUserData(rowId, "rowType") == "input" && (${GridObjName}.getUserData(rowId, "tmsTytenName") != null && ${GridObjName}.getUserData(rowId, "tmsTytenName") != "")){
            var value = ${GridObjName}.cells(rowId, 8).getValue();
            var planTaiGaiFlgTok = ${GridObjName}.getUserData(rowId, "planTaiGaiFlgTok");
            if (planTaiGaiFlgTok != 'undefined' && planTaiGaiFlgTok != null && planTaiGaiFlgTok != '' && planTaiGaiFlgTok == 'true') {
                if (value != 'undefined' && value != null && value != '') {
                    alert('$text.get("DPM999C00.001","dialogue")');
                    return;
                }
            }
            var rowIdList = ${GridObjName}.getUserData(rowId, "rowIdList");
            var sendvalue = rowIdList + "," + value;
            var element = document.createElement('input');
            element.type = "hidden";
            element.name = "rowIdList";
            element.value = sendvalue;
            form.appendChild(element);
        }
    }
    ##送信
    form.action = '$link.setAction("dpm400C00F20Excecute")';
    form.submit();

    dpm400C01F05 = blockIt;
    dpm400C01F10Excecute = blockIt;
}

## 施設追加画面呼出（ワ）
function dpm911C00F00Vac() {
    var func = "dpm400C00InsApplyVac";
    var insPtn = "01";
    var ptn = "02";
    var min = "02";
    var max = "04";
    #if($form.bean.sosCd4 && $form.bean.sosCd4 != "")
	    var sosInitSosCodeValue = "$!form.bean.sosCd4";
    #else
    	var sosInitSosCodeValue = "$!form.bean.sosCd3";
    #end
    var jgiNo = "$!form.bean.jgiNo";
    var addrCodePref = "$!form.bean.addrCodePref";
    var addrCodeCity = "$!form.bean.addrCodeCity";

    ## 一般先/重点先 指定
    #if ($form.bean.activityType && $form.bean.activityType == "1")
        var jtnFlg = "true";
        var ippanFlg = "false";
    #elseif ($form.bean.activityType && $form.bean.activityType == "2")
        var jtnFlg = "false";
        var ippanFlg = "true";
    #else
        var jtnFlg = "false";
        var ippanFlg = "false";
    #end

    var url ="$link.setAction('dpm911C00F00')";
    url = url.concat("?insApplyFuncName=").concat(func);
    url = url.concat("&insSelectPtnType=").concat(insPtn);
    url = url.concat("&sosSrchPtnType=").concat(ptn);
    url = url.concat("&sosMinSrchValue=").concat(min);
    url = url.concat("&sosMaxSrchGetValue=").concat(max);
    url = url.concat("&sosInitSosCodeValue=").concat(sosInitSosCodeValue);
    url = url.concat("&paramJgiNo=").concat(jgiNo);
    url = url.concat("&paramJtnFlg=").concat(jtnFlg);
    url = url.concat("&paramIppanFlg=").concat(ippanFlg);
    url = url.concat("&sosSearchNonFlg=").concat("true");
    url = url.concat("&paramAddrCodePref=").concat(addrCodePref);
    url = url.concat("&paramAddrCodeCity=").concat(addrCodeCity);
    url = url.concat("&disableDelInsSelect=").concat("true");
    url = url.concat("&disableMallInsSelect=").concat("true");

    var args = new Array();
    openModalWindowW(url, func, args);
}



## ダウンロード処理
function dpm400C00F14(){
	var category = document.getElementById("prodCategory").value;
    ##ワクチンの場合
    if (category == "$vaccineCode") {
		if (!searchValidationForVac()) {
	    	return;
		}
	} else {
		if (!searchValidation()) {
	    	return;
		}
	}

    ##確認
    if (!confirm('$text.get("DPM400C00.005","dialogue")')) {
        return;
    }

    ##ワクチンの場合
    if (category == "$vaccineCode") {
	    var actionPath = '$link.setAction('dpm400C00F24Output')';
	    document.dpm400C00F05Form.action = actionPath;
	    document.dpm400C00F05Form.submit();
    ##ワクチン以外の場合
    }else{
	    var actionPath = '$link.setAction('dpm400C00F14Output')';
	    document.dpm400C00F05Form.action = actionPath;
	    document.dpm400C00F05Form.submit();
    }
    return false;
}

function initializeCategory(){
	var defaultCat = document.getElementById('prodCategoryTran').value;
	changeCategory();
	if(!prodCategoryTran){
		return;
	}
	var options = document.getElementById('prodCategory').options;
	for(var i = 0; i < options.length ;i++ ){
		if (options[i].value == defaultCat ) {
			options[i].selected = true;
			break;
		}
	}
	changeProd();
}

//-->
</script>

<div id="noTabBox">
<form name="dpm400C00F05Form" method="post" style="padding:0px;margin-bottom:5px;">
##（施設）処理用項目定義
<input type="hidden" id="sosCd2Tran" name="sosCd2Tran" value="$!form.bean.sosCd2Tran">
<input type="hidden" id="insTypeTran" name="insTypeTran" value="$!form.bean.insTypeTran">
<input type="hidden" id="tmsTytenCdPartTran" name="tmsTytenCdPartTran" value="$!form.bean.tmsTytenCdPartTran">
<input type="hidden" id="prodCategoryTran" name="prodCategoryTran" value="$!form.bean.prodCategoryTran">
<input type="hidden" id="planDataTran" name="planDataTran" value="$!form.bean.planDataTran">
##（ワ）処理用項目定義
<input type="hidden" id="activityTypeTran" name="activityTypeTran" value="$!form.bean.activityTypeTran">
<input type="hidden" id="addrCodePrefTran" name="addrCodePrefTran" value="$!form.bean.addrCodePrefTran">
<input type="hidden" id="addrCodeCityTran" name="addrCodeCityTran" value="$!form.bean.addrCodeCityTran">
##（共通）処理用項目定義
<input type="hidden" id="sosCd3Tran" name="sosCd3Tran" value="$!form.bean.sosCd3Tran">
<input type="hidden" id="sosCd4Tran" name="sosCd4Tran" value="$!form.bean.sosCd4Tran">
<input type="hidden" id="jgiNoTran" name="jgiNoTran" value="$!form.bean.jgiNoTran">
<input type="hidden" id="etcSosFlgTran" name="etcSosFlgTran" value="$!form.bean.etcSosFlgTran">
<input type="hidden" id="insNoTran" name="insNoTran" value="$!form.bean.insNoTran">
<input type="hidden" id="tmsTytenCdTran" name="tmsTytenCdTran" value="$!form.bean.tmsTytenCdTran">
<input type="hidden" id="prodCodeTran" name="prodCodeTran" value="$!form.bean.prodCodeTran">
##（ワ）項目定義
<input type="hidden" name="shikuchosonMeiKj" id="shikuchosonMeiKj" value="$!form.bean.shikuchosonMeiKj" />
<input type="hidden" name="fukenMeiKj" id="fukenMeiKj" value="$!form.bean.fukenMeiKj" />
<input type="hidden" name="addrCodePref" id="addrCodePref" value="$!form.bean.addrCodePref" />
<input type="hidden" name="addrCodeCity" id="addrCodeCity" value="$!form.bean.addrCodeCity" />
<table class="gridLine" style="float: left; margin-right: 10px;" cellspacing="0" cellpadding="1">
    <tr>
        <td class="gridIndex" style="width: 100px;">組織・担当者*</td>
        <td>#sosDialogExt2("sosDialogAfter", "01", "02", "04", "DPM40")</td>
    </tr>
    <tr>
        <td class="gridIndex" style="width: 100px;">カテゴリ*</td>
        <td>
        <table cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
            <tr>
                <td style="padding-right: 21px">#selectWithFunc ("prodCategory", $!form.bean.prodCategoryList, $!form.bean.prodCategory, "changeProd();changeInsKbn();")</td>
                <td class="gridIndex" style="width: 100px;">品目*</td>
                <td>
                    #select( "prodCode", $prodList, $form.bean.prodCode )
                </td>
            </tr>
        </table>
        </td>
    </tr>
    ##カテゴリが医薬の場合、「対象区分」「計画」を表示
    <tr id="insType_tr">
        <td class="gridIndex" style="width: 100px;">対象区分*</td>
        <td style="padding-right: 21px">#select ("insType", $insKbnList, $!form.bean.insType)</td>
        ## <td style="padding-right: 21px">#select ("insType", $form.bean.insTypes, $!form.bean.insType)</td>
    </tr>
    <tr id="planData_tr">
        <td class="gridIndex" style="width: 100px;">計画*</td>
        <td style="padding: 0px 7px 0px 0px;">
        #if($form.bean.planData == "0")
            <label><input type="radio" name="planData" value="0" checked />計画あり</label>
            <label><input type="radio" name="planData" value="1"         />全施設</label>
        #elseif($form.bean.planData == "1")
            <label><input type="radio" name="planData" value="0"         />計画あり</label>
            <label><input type="radio" name="planData" value="1" checked />全施設</label>
        #else
            <label><input type="radio" name="planData" value="0" checked />計画あり</label>
            <label><input type="radio" name="planData" value="1"         />全施設</label>
        #end
        </td>
    </tr>
    ##カテゴリがワクチンの場合、「重点先/一般先」「市区町村」を表示
    <tr id="activityType_tr">
        <td class="gridIndex" style="width: 100px;">重点先/一般先*</td>
        <td>#select ("activityType", $form.bean.activityTypes, $!form.bean.activityType)</td>
    </tr>
    <tr id="addr_tr">
        <td class="gridIndex" style="width: 100px;">市区町村</td>
        <td>
        <table cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
            <tr>
                <td>
                <table class="gridLine" cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
                    <tr>
                        <td style="width: 270px;">
                            <nobr><label id="shikuchosonMeiKjLabel">$fukenMeiKj　$shikuchosonMeiKj</label></nobr>
                        </td>
                    </tr>
                </table>
                </td>
                <td style="padding: 0px 5px 0px 5px"><input type="button" value="選択" onclick="dpm913C00F00();" style="width: 80px;" /></td>
                <td style="padding: 0px 5px 0px 5px"><a href="#" onclick="dpm400C00AddrClear();">クリア</a></td>
            </tr>
        </table>
        </td>
    </tr>
</table>
<table class="gridLine" cellspacing="0" cellpadding="1">
    <tr>
        <td class="gridIndex" style="width: 100px;">施設</td>
        <td>
        <table cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
            <tr>
                <td>
                <table class="gridLine" cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
                    <tr>
                        <td style="width: 270px;">
                            <nobr><label id="insNameLabel">　</label></nobr>
                            <input type="hidden" name="insName" id="insName" value="$!form.bean.insName" />
                        </td>
                    </tr>
                </table>
                </td>
                <td style="padding: 0px 5px 0px 5px">
                  <input type="button" id="v_ins_select" value="選択" style="width: 80px; display:none;" onclick="dpm911C00F00();"/>
                  <input type="button" id="ins_select" value="選択" style="width: 80px;" onclick="dpm911C00F00()"/>
                </td>
            </tr>
        </table>
        </td>
    </tr>
    <tr>
        <td class="gridIndex" style="width: 100px;">施設コード</td>
        <td>
        <table cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
            <tr>
                <td>
                    <input type="text" name="insNo" id="insNo" value="$!form.bean.insNo" size="20" maxlength="14" style="ime-mode: disabled" onkeyup="dpm400C00InsClear();" />
                </td>
                <td style="padding: 0px 5px 0px 5px"><a href="#" onclick="document.getElementById('insNo').value = '';dpm400C00InsClear();">クリア</a></td>
            </tr>
        </table>
        </td>
    </tr>
        <tr>
        <td class="gridIndex" style="width: 100px;">特約店</td>
        <td>
        <table cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
            <tr>
                <td>
                <table class="gridLine" cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
                    <tr>
                        <td style="width: 270px;">
                            <nobr><label id="tmsTytenNameLabel">　</label></nobr>
                            <input type="hidden" name="tmsTytenName" id="tmsTytenName" value="$!form.bean.tmsTytenName" />
                            <input type="hidden" name="tmsTytenCd" id="tmsTytenCd" value="$!form.bean.tmsTytenCd" />
                        </td>
                    </tr>
                </table>
                </td>
                <td style="padding: 0px 5px 0px 5px">
                  <input type="button" id="v_tyten_select" value="選択" style="width: 80px; display: none;" onclick="openTytenSearchDialogVac()" />
                  <input type="button" id="tyten_select" value="選択" style="width: 80px;" onclick="openTytenSearchDialog()" />
                </td>
            </tr>
        </table>
        </td>
    </tr>
    <tr>
        <td class="gridIndex" style="width: 100px;">特約店コード</td>
        <td>
        <table cellspacing="0" cellpadding="0" style="border-collapse: collapse;">
            <tr>
                <td>
                    <input type="text" name="tmsTytenCdPart" id="tmsTytenCdPart" value="$!form.bean.tmsTytenCdPart" size="20" maxlength="13" style="ime-mode: disabled" onkeyup="dpm400C00TytenSearchClear()" />
                </td>
                <td style="padding: 0px 5px 0px 5px"><a href="#" onclick="document.getElementById('tmsTytenCdPart').value = '';dpm400C00TytenSearchClear();">クリア</a></td>
            </tr>
        </table>
        </td>
    </tr>
</table>
<table style="margin-top: 2px; margin-bottom: 2px; float: left; width: 100%;">
    <tr>
        ##品目：ワクチン以外
        <td id="no_vaccine_button_td">
            <input type="button" value="表示" style="width: 80px;" onclick="dpm400C00F05()" />
            #if($!security.hasAuthEdit("DPM40"))
	            #if ($dataList)
	                #if ($dataList.enableEntry)
	                <input type="button" value="登録" style="width: 80px;" onclick="dpm400C00F10()" />
	                ## 削除予定施設の場合、登録不可
	                #else
	                <input type="button" value="登録" style="width: 80px;" onclick="dpm400C00F10()" disabled />
	                #end
	            #else
	            	<input type="button" value="登録" style="width: 80px;" onclick="dpm400C00F10()" disabled />
	            #end
            #end
            ## データが存在する場合、ボタンを活性化する。
            #if ($dataList)
                <input type="button" value="ダウンロード" style="width: 120px;" onclick="dpm400C00F14()" />
            #else
                <input type="button" value="ダウンロード" style="width: 120px;" disabled />
            #end
        </td>
        ##品目：ワクチン
        <td id="vaccine_button_td">
	        <input type="button" value="表示" style="width: 80px;" onclick="dpm400C00F05()" />
	        #if($security.hasAuthEdit("DPM40"))
		        #if ($form.getRequestData("DPM400C00_ENABLE_INS_ENTRY"))
		            <input type="button" value="施設追加" style="width: 80px;" onclick="dpm911C00F00Vac()" />
		        #else
		            <input type="button" value="施設追加" style="width: 80px;" onclick="dpm911C00F00Vac()" disabled />
		        #end
		        #if ($dataListVaccine)
		            <input type="button" id="regist" value="登録" style="width: 80px;" onclick="dpm400C00F20Excecute()" />
		        #else
		            <input type="button" id="regist" value="登録" style="width: 80px;" onclick="dpm400C00F20Excecute()" disabled />
		        #end
	        #end
	        ## データが存在する場合、ボタンを活性化する。
	        #if ($dataListVaccine)
	            <input type="button" value="ダウンロード" style="width: 120px;" onclick="dpm400C00F14()" />
	        #else
	            <input type="button" value="ダウンロード" style="width: 120px;" disabled />
	        #end
        </td>
	    <td>
	        <table>
	            <tr>
	                <td style="width: 10px;"></td>
	                <td class="delIns" style="border: 1px solid #000000; width: 50px;">&nbsp;</td>
	                <td style="padding-right: 10px;"><label>：削除予定施設</label></td>
	            </tr>
	        </table>
        </td>
        <td style="text-align: right; vertical-align: bottom;"><label>$consts.tableHeader</label></td>
    </tr>
</table>
#if($form.bean.prodCategory == "$vaccineCode")
	#parse("WEB-INF/view/pages/dpm/dpm400C00_2.vm")
#else
    #parse("WEB-INF/view/pages/dpm/dpm400C00_1.vm")
#end
#token()
</form>
</div>
<div style="display: none;">
<form name="dpm400C00F10Form" action="$!{link.setAction('dpm400C00F10Excecute')}" method="post">
    #token()
</form>
</div>
